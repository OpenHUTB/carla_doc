<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Linux 系统上的构建 - 人车模拟器</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Linux \u7cfb\u7edf\u4e0a\u7684\u6784\u5efa";
        var mkdocs_page_input_path = "build_linux.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 人车模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">首页</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">人车模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Linux 系统上的构建</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/doc/edit/master/docs/build_linux.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="linux">Linux 系统上的构建</h1>
<p>本指南详细介绍了如何在 Linux 上从源代码构建 Carla。有两个部分。第一部分详细介绍系统要求和所需软件的安装，第二部分详细介绍如何实际构建和运行 Carla。</p>
<p>构建过程很长（4小时或更长时间）并且涉及多种软件。强烈建议在开始之前完整阅读该指南。</p>
<ul>
<li><a href="#part-one-prerequisites"><strong>第一部分：先决条件</strong></a><ul>
<li><a href="#system-requirements">系统要求</a></li>
<li><a href="#software-requirements">软件要求</a><ul>
<li><a href="#unreal-engine">虚幻引擎</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#part-two-build-carla"><strong>第二部分：构建 Carla</strong></a><ul>
<li><a href="#clone-the-carla-repository">克隆 Carla 仓库</a></li>
<li><a href="#get-assets">获取资产</a></li>
<li><a href="#set-unreal-engine-environment-variable">设置虚幻引擎环境变量</a></li>
<li><a href="#build-carla">构建 Carla</a></li>
<li><a href="#other-make-commands">其他 make 命令</a></li>
<li><a href="#other">其他</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="_1">第一部分：先决条件 <span id="part-one-prerequisites"></span></h2>
<h3 id="_2">系统要求 <span id="system-requirements"></span></h3>
<ul>
<li><strong>Ubuntu 18.04.</strong> Carla 提供对 Ubuntu 16.04 之前版本的支持。<strong>然而</strong>，虚幻引擎需要适当的编译器才能正常工作。下面单独列出了 Ubuntu 18.04 及之前版本的依赖项。确保安装与您的系统相对应的软件。</li>
<li><strong>130 GB 磁盘空间。</strong> Carla 将占用大约 31 GB，虚幻引擎将占用大约 91 GB，因此需要大约 130 GB 的可用空间来容纳这两个空间以及额外的小型软件安装。</li>
<li><strong>足够的 GPU。</strong> Carla 的目标是进行真实的模拟，因此服务器至少需要 6 GB GPU，但建议使用 8 GB。强烈建议使用专用 GPU 进行机器学习。 </li>
<li><strong>两个 TCP 端口和良好的互联网连接。</strong> 默认为 2000 年和 2001 年。确保这些端口未被防火墙或任何其他应用程序阻止。</li>
</ul>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p><strong>如果您要从 Carla 0.9.12 升级到 0.9.13</strong>: 您必须首先将虚幻引擎 4 的 Carla 分支升级到最新版本。有关升级虚幻引擎 4 的详细信息，请参阅 <a href="#unreal-engine"><strong>虚幻引擎</strong></a> 部分。</p>
</div>
<h3 id="_3">软件要求 <span id="software-requirements"></span></h3>
<p>Carla 需要运行多种不同类型的软件。有些是在 Carla 构建过程本身期间构建的，例如<em>Boost.Python</em>。其他是应该在开始构建之前安装的二进制文件（<em>cmake</em>、<em>clang</em>、不同版本的<em>Python</em>等）。要安装这些要求，请运行以下命令：</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>wget<span class="w"> </span>software-properties-common<span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>add-apt-repository<span class="w"> </span>ppa:ubuntu-toolchain-r/test<span class="w"> </span><span class="o">&amp;&amp;</span>
wget<span class="w"> </span>-O<span class="w"> </span>-<span class="w"> </span>https://apt.llvm.org/llvm-snapshot.gpg.key<span class="p">|</span>sudo<span class="w"> </span>apt-key<span class="w"> </span>add<span class="w"> </span>-<span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-8 main&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</code></pre></div>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>以下命令取决于您的 Ubuntu 版本。请务必做出相应的选择。</p>
</div>
<p><strong>Ubuntu 24.04</strong>
<div class="highlight"><pre><span></span><code><span class="c1"># 显卡驱动使用nvidia-driver-470-server（转有）</span>
<span class="c1"># 已经安装了clang-14</span>
<span class="c1"># sudo apt install g++-10</span>
<span class="c1"># sudo apt-get install clang++-10</span>

<span class="c1"># 源代码编译安装 llvm-10</span>
sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>gcc-multilib
git<span class="w"> </span>clone<span class="w"> </span>--branch<span class="w"> </span>release/10.x<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/llvm/llvm-project
<span class="nb">cd</span><span class="w"> </span>llvm-project/llvm
cmake<span class="w"> </span>-G<span class="w"> </span><span class="s2">&quot;Unix Makefiles&quot;</span><span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DLLVM_ENABLE_PROJECTS<span class="o">=</span>lld<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr/local/llvm-10<span class="w"> </span>..
make<span class="w"> </span>-j8
sudo<span class="w"> </span>make<span class="w"> </span>install
<span class="c1"># /usr/local/llvm-10/bin</span>
<span class="c1"># 编译clang-10（默认LLVM编译完没有clang）</span>
<span class="c1"># 回到llvm-project目录</span>
<span class="nb">cd</span><span class="w"> </span>llvm-project/clang/
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
cmake<span class="w"> </span>-G<span class="w"> </span><span class="s2">&quot;Unix Makefiles&quot;</span><span class="w"> </span>-DCMAKE_BUILD_TYPE<span class="o">=</span>Release<span class="w"> </span>-DCMAKE_INSTALL_PREFIX<span class="o">=</span>/usr/local/clang-10<span class="w"> </span>..
make<span class="w"> </span>-j8
sudo<span class="w"> </span>make<span class="w"> </span>install
<span class="c1"># 创建软链接</span>
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/local/clang-10/bin/clang++<span class="w"> </span>/usr/bin/clang++
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/local/clang-10/bin/clang<span class="w"> </span>/usr/bin/clang
<span class="c1"># 检查版本</span>
clang<span class="w"> </span>--version

<span class="c1"># 源代码编译安装 gcc-7</span>
wget<span class="w"> </span>http://ftp.gnu.org/gnu/gcc/gcc-7.5.0/gcc-7.5.0.tar.gz
tar<span class="w"> </span>-zxvf<span class="w"> </span>gcc-7.5.0.tar.gz
<span class="nb">cd</span><span class="w"> </span>gcc-7.5.0
mkdir<span class="w"> </span>build
<span class="nb">cd</span><span class="w"> </span>build
../configure<span class="w"> </span>--prefix<span class="o">=</span>/usr/local/gcc-7<span class="w">  </span><span class="c1"># 开始配置安装</span>
<span class="c1"># 如果安装缺少的库，则运行下面这一条命令</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>libgmp-dev<span class="w"> </span>libmpfr-dev<span class="w"> </span>libmpc-dev<span class="w"> </span>gcc-multilib<span class="w"> </span>g++-multilib
<span class="c1"># 再次使用下面命令构建安装环境</span>
../configure<span class="w"> </span>--enable-multilib
<span class="c1"># 构建完成后得到一个Makefile文件。开始编译</span>
make<span class="w"> </span>-j8<span class="w">  </span><span class="c1"># -j选项后的数字取决于机器的逻辑处理器数量</span>
sudo<span class="w"> </span>make<span class="w"> </span>install
<span class="c1"># 创建软链接</span>
sudo<span class="w"> </span>ln<span class="w"> </span>-s<span class="w"> </span>/usr/local/clang-10/bin/clang++<span class="w"> </span>/usr/bin/g++


sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/bin/clang++-14<span class="w"> </span><span class="m">180</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/bin/clang-14<span class="w"> </span><span class="m">180</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/g++<span class="w"> </span>g++<span class="w"> </span>/usr/bin/g++-12<span class="w"> </span><span class="m">180</span>
</code></pre></div></p>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>构建时对<code>Util/BuildTools/Setup.sh</code>所做的修改：1. 构建boost时，执行<code>./bootstrap.sh</code>的命令中去除了<code>--with-toolset=clang</code>选项。2. 对rcplib执行cmake时，去除了<code>-stdlib=libc++</code>选项。</p>
</div>
<p><strong>Ubuntu 22.04</strong>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb http://archive.ubuntu.com/ubuntu focal main universe&quot;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>clang-10<span class="w"> </span>lld-10<span class="w"> </span>g++-7<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>libvulkan1<span class="w"> </span>python<span class="w"> </span>python3<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff5-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>tzdata<span class="w"> </span>sed<span class="w"> </span>curl<span class="w"> </span>unzip<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>rsync<span class="w"> </span>libxml2-dev<span class="w"> </span>git<span class="w"> </span>git-lfs
<span class="c1"># update-alternatives的第一个参数--install表示向update-alternatives注册服务名。</span>
<span class="c1"># 第二个参数是注册最终地址，成功后将会把命令在这个固定的目的地址做真实命令的软链，以后管理就是管理这个软链；</span>
<span class="c1"># 第三个参数：服务名，以后管理时以它为关联依据。</span>
<span class="c1"># 第四个参数，被管理的命令绝对路径。</span>
<span class="c1"># 第五个参数，优先级，数字越大优先级越高。</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/lib/llvm-10/bin/clang++<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/lib/llvm-10/bin/clang<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/g++<span class="w"> </span>g++<span class="w"> </span>/usr/bin/g++-7<span class="w"> </span><span class="m">180</span>
</code></pre></div></p>
<p><strong>Ubuntu 20.04</strong>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb http://apt.llvm.org/focal/ llvm-toolchain-focal main&quot;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>clang-10<span class="w"> </span>lld-10<span class="w"> </span>g++-7<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>libvulkan1<span class="w"> </span>python<span class="w"> </span>python-dev<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff5-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>tzdata<span class="w"> </span>sed<span class="w"> </span>curl<span class="w"> </span>unzip<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>rsync<span class="w"> </span>libxml2-dev<span class="w"> </span>git
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/lib/llvm-10/bin/clang++<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/lib/llvm-10/bin/clang<span class="w"> </span><span class="m">180</span>
</code></pre></div></p>
<p><strong>Ubuntu 18.04</strong>.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb http://apt.llvm.org/bionic/ llvm-toolchain-bionic main&quot;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>clang-8<span class="w"> </span>lld-8<span class="w"> </span>g++-7<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>libvulkan1<span class="w"> </span>python<span class="w"> </span>python-pip<span class="w"> </span>python-dev<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>libpng-dev<span class="w"> </span>libtiff5-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>tzdata<span class="w"> </span>sed<span class="w"> </span>curl<span class="w"> </span>unzip<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>rsync<span class="w"> </span>libxml2-dev<span class="w"> </span>git
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/lib/llvm-8/bin/clang++<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/lib/llvm-8/bin/clang<span class="w"> </span><span class="m">180</span>
</code></pre></div>
<p><strong>Ubuntu 16.04</strong>.</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-add-repository<span class="w"> </span><span class="s2">&quot;deb http://apt.llvm.org/xenial/ llvm-toolchain-xenial-8 main&quot;</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>apt-get<span class="w"> </span>update
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>clang-8<span class="w"> </span>lld-8<span class="w"> </span>g++-7<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>libvulkan1<span class="w"> </span>python<span class="w"> </span>python-pip<span class="w"> </span>python-dev<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>libpng16-dev<span class="w"> </span>libtiff5-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>tzdata<span class="w"> </span>sed<span class="w"> </span>curl<span class="w"> </span>unzip<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>rsync<span class="w"> </span>libxml2-dev<span class="w"> </span>git
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/lib/llvm-8/bin/clang++<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/lib/llvm-8/bin/clang<span class="w"> </span><span class="m">180</span>
</code></pre></div>
<p><strong>以前的 Ubuntu</strong> 版本。</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>build-essential<span class="w"> </span>clang-8<span class="w"> </span>lld-8<span class="w"> </span>g++-7<span class="w"> </span>cmake<span class="w"> </span>ninja-build<span class="w"> </span>libvulkan1<span class="w"> </span>python<span class="w"> </span>python-pip<span class="w"> </span>python-dev<span class="w"> </span>python3-dev<span class="w"> </span>python3-pip<span class="w"> </span>libpng16-dev<span class="w"> </span>libtiff5-dev<span class="w"> </span>libjpeg-dev<span class="w"> </span>tzdata<span class="w"> </span>sed<span class="w"> </span>curl<span class="w"> </span>unzip<span class="w"> </span>autoconf<span class="w"> </span>libtool<span class="w"> </span>rsync<span class="w"> </span>libxml2-dev<span class="w"> </span>git
</code></pre></div>
<p><strong>所有 Ubuntu 系统</strong>。</p>
<p>为了避免虚幻引擎和 Carla 依赖项之间的兼容性问题，请使用相同的编译器版本和 C++ 运行时库来编译所有内容。Carla 团队使用 clang-8 和 LLVM 的 libc++。更改默认的 clang 版本以编译虚幻引擎和 Carla 依赖项。</p>
<div class="highlight"><pre><span></span><code>sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang++<span class="w"> </span>clang++<span class="w"> </span>/usr/lib/llvm-8/bin/clang++<span class="w"> </span><span class="m">180</span><span class="w"> </span><span class="o">&amp;&amp;</span>
sudo<span class="w"> </span>update-alternatives<span class="w"> </span>--install<span class="w"> </span>/usr/bin/clang<span class="w"> </span>clang<span class="w"> </span>/usr/lib/llvm-8/bin/clang<span class="w"> </span><span class="m">180</span>
</code></pre></div>
<p>从 Carla 0.9.12 开始，用户可以选择使用<code>pip</code>或<code>pip3</code>安装 Carla Python API。需要 20.3 或更高版本。要检查您是否有合适的版本，请运行以下命令：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 对于 Python 3</span>
pip3<span class="w"> </span>-V

<span class="c1"># 对于 Python 2</span>
pip<span class="w"> </span>-V
</code></pre></div>
<p>如果您需要升级：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 对于 Python 3</span>
pip3<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip

<span class="c1"># 对于 Python 2</span>
pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>pip
</code></pre></div>
<p>您必须安装以下 Python 依赖项：</p>
<div class="highlight"><pre><span></span><code>pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>setuptools<span class="w"> </span><span class="o">&amp;&amp;</span>
pip3<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>-Iv<span class="w"> </span><span class="nv">setuptools</span><span class="o">==</span><span class="m">47</span>.3.1<span class="w"> </span><span class="o">&amp;&amp;</span>
pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>distro<span class="w"> </span><span class="o">&amp;&amp;</span>
pip3<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>distro<span class="w"> </span><span class="o">&amp;&amp;</span>
pip<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>wheel<span class="w"> </span><span class="o">&amp;&amp;</span>
pip3<span class="w"> </span>install<span class="w"> </span>--user<span class="w"> </span>wheel<span class="w"> </span>auditwheel
</code></pre></div>
<hr />
<h4 id="_4">虚幻引擎 <span id="unreal-engine"></span></h4>
<p>从版本 0.9.12 开始，Carla 使用虚幻引擎 4.26 的修改版。该分支包含 Carla 特有的补丁。</p>
<p><strong>1.</strong> 将 Carla 的虚幻引擎 4.26 分支的内容克隆到本地计算机：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OpenHUTB/UnrealEngine.git<span class="w"> </span>~/UnrealEngine_4.26
</code></pre></div>
<p><strong>2.</strong> 导航到克隆存储库的目录：
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/UnrealEngine_4.26
</code></pre></div></p>
<p><strong>3.</strong> 进行构建。这可能需要一两个小时，具体取决于您的系统。
<div class="highlight"><pre><span></span><code>./Setup.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./GenerateProjectFiles.sh<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>make
</code></pre></div>
如果出现
<div class="highlight"><pre><span></span><code>bash: ./Setup.sh: Permission denied
./Setup.sh: line 40: Engine/Build/BatchFiles/Linux/GitDependencies.sh: Permission denied
Engine/Build/BatchFiles/Linux/GitDependencies.sh: line 25: mono: command not found

Setting up Mono
Corlib not in sync with this runtime: expected corlib version 149, found 1051600014.
</code></pre></div></p>
<div class="highlight"><pre><span></span><code>chmod<span class="w"> </span>+x<span class="w"> </span>Setup.sh
chmod<span class="w"> </span>+x<span class="w"> </span>Engine/Build/BatchFiles/Linux/GitDependencies.sh
sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>mono-complete
git<span class="w"> </span>clone<span class="w"> </span>https://github.com/OpenHUTB/UnrealEngine.git<span class="w"> </span>~/UnrealEngine_4.26
</code></pre></div>
<p><strong>4.</strong> 打开编辑器检查虚幻引擎是否已正确安装。
<div class="highlight"><pre><span></span><code><span class="nb">cd</span><span class="w"> </span>~/UnrealEngine_4.26/Engine/Binaries/Linux<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>./UE4Editor
</code></pre></div></p>
<p>电脑配置达不到Vulkan的标准会出现（OpenGL的API也废弃了）：
<div class="highlight"><pre><span></span><code>Cannot find a compatible Yulkan driver (ICD)
</code></pre></div></p>
<hr />
<h2 id="carla">第二部分：构建 Carla <span id="part-two-build-carla"></span></h2>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>使用 <code>sudo apt-get install aria2</code> 下载 aria2 将加快以下命令的速度。</p>
</div>
<h3 id="carla_1">克隆 Carla 仓库 <span id="clone-the-carla-repository"></span></h3>
<div class="build-buttons">
<p>
<a href="https://github.com/carla-simulator/carla" target="_blank" class="btn btn-neutral" title="跳转至 Carla 仓库">
<span class="icon icon-github"></span> Carla 仓库</a>
</p>
</div>
<p>上面的按钮将带您进入该项目的官方存储库。从那里下载并在本地提取它或使用以下命令克隆它：</p>
<div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>https://github.com/carla-simulator/carla.git
</code></pre></div>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>The <code>master</code> 分支包含 Carla 的当前版本以及最新的修复和功能。以前的 Carla 版本标有版本名称。永远记住使用命令<code>git branch</code>检查 git 中的当前分支。 </p>
</div>
<h3 id="_5">获取资产 <span id="get-assets"></span></h3>
<p>您需要下载 <strong>最新的</strong> 资源才能使用当前版本的 Carla。我们提供了一个脚本来自动执行此过程。要使用该脚本，请在 Carla 根文件夹中运行以下命令：</p>
<div class="highlight"><pre><span></span><code>./Update.sh
</code></pre></div>
<p>资源将被下载并提取到适当的位置。</p>
<div class="admonition 重要">
<p class="admonition-title">重要</p>
<p>要下载当前正在开发的资产，请访问 <a href="../build_update/#get-development-assets">更新 Carla</a> 并阅读 <strong>获取开发资产</strong>。</p>
</div>
<p>要下载 <strong>特定版本</strong> 的 Carla 资源：</p>
<ol>
<li>从 Carla 根目录，导航到 <code>\Util\ContentVersions.txt</code>。本文档包含所有 Carla 版本的资源链接。</li>
<li>提取 <code>Unreal\CarlaUE4\Content\Carla</code> 中的资产。如果该路径不存在，请创建它。</li>
<li>使用类似以下内容的命令提取文件：</li>
</ol>
<div class="highlight"><pre><span></span><code>tar<span class="w"> </span>-xvzf<span class="w"> </span>&lt;assets_file_name&gt;.tar.gz.tar<span class="w"> </span>-C<span class="w"> </span>C:<span class="se">\p</span>ath<span class="se">\t</span>o<span class="se">\c</span>arla<span class="se">\U</span>nreal<span class="se">\C</span>arlaUE4<span class="se">\C</span>ontent<span class="se">\C</span>arla
</code></pre></div>
<h3 id="_6">设置虚幻引擎环境变量 <span id="set-unreal-engine-environment-variable"></span></h3>
<p>为了让 Carla 找到虚幻引擎的正确安装，我们需要设置 Carla 环境变量。</p>
<p>仅为此会话设置变量：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UE4_ROOT</span><span class="o">=</span>~/UnrealEngine_4.26
</code></pre></div>
<p>要设置变量以使其在会话中保持不变：</p>
<p><strong>1.</strong> 打开 <code>~/.bashrc</code> 或 <code>./profile</code>。<br />
<div class="highlight"><pre><span></span><code>gedit<span class="w"> </span>~/.bashrc
<span class="c1"># 或 </span>
gedit<span class="w"> </span>~/.profile
</code></pre></div></p>
<p><strong>2.</strong> 将以下行添加到文件底部：</p>
<div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">UE4_ROOT</span><span class="o">=</span>~/UnrealEngine_4.26<span class="w"> </span>
</code></pre></div>
<p><strong>3.</strong> 保存文件并重置终端。</p>
<h3 id="carla_2">构建 Carla <span id="build-carla"></span></h3>
<p>本节概述了构建 Carla 的命令。<strong>所有命令都应在根 Carla 文件夹中运行。</strong></p>
<p>Carla 的构建过程分为两个部分，编译客户端和编译服务器。</p>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>确保运行 <code>make PythonAPI</code> 以准备客户端和运行 <code>make launch</code> 准备服务端。
或者 <code>make LibCarla</code> 将准备 Carla 库以导入到任何地方。</p>
</div>
<p><strong>1.</strong> <strong>编译 Python API 客户端：</strong>：</p>
<p>Python API 客户端授予对模拟的控制权。第一次构建 Carla 时需要编译 Python API 客户端，并且在执行任何更新后需要再次编译。客户端编译完成后，您将能够运行脚本与模拟进行交互。</p>
<p>以下命令编译 Python API 客户端：</p>
<div class="highlight"><pre><span></span><code>make<span class="w"> </span>PythonAPI
</code></pre></div>
<p>或者，要为特定版本的 Python 编译 PythonAPI，请在根 Carla 目录中运行以下命令。</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Delete versions as required</span>
make<span class="w"> </span>PythonAPI<span class="w"> </span><span class="nv">ARGS</span><span class="o">=</span><span class="s2">&quot;--python-version=2.7, 3.6, 3.7, 3.8&quot;</span>
</code></pre></div>
<p>Carla 客户端库将以两种截然不同、互斥的形式构建。这使用户可以自由选择他们喜欢的形式来运行 Carla 客户端代码。两种形式包括<code>.egg</code>文件和<code>.whl</code>文件。选择以下选项之一来使用客户端库：</p>
<p><strong>A. <code>.egg</code> 文件</strong></p>
<blockquote>
<p><code>.egg</code> 文件不需要安装。导入 Carla 时，Carla 的所有示例脚本都会自动 <a href="../build_system/#versions-prior-to-0912">查找此文件</a> 。</p>
<p>如果您之前安装了 Carla  <code>.whl</code>，<code>.whl</code> 将优先于 <code>.egg</code> 文件。</p>
</blockquote>
<p><strong>B. <code>.whl</code> 文件</strong></p>
<blockquote>
<p><code>.whl</code> 文件应使用 <code>pip</code> 或 <code>pip3</code> 安装：</p>
</blockquote>
<div class="highlight"><pre><span></span><code><span class="c1"># Python 3</span>
pip3<span class="w"> </span>install<span class="w"> </span>&lt;path/to/wheel&gt;.whl

<span class="c1"># Python 2</span>
pip<span class="w"> </span>install<span class="w"> </span>&lt;path/to/wheel&gt;.whl
</code></pre></div>
<blockquote>
<p><code>.whl</code> 文件无法分发，因为它是专门为您的操作系统构建的。</p>
</blockquote>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>使用不同方法安装 Carla 客户端库以及系统上安装不同版本的 Carla 可能会出现问题。建议在安装时使用虚拟环境，并在安装<code>.whl</code>新客户端库之前卸载任何以前安装的客户端库。</p>
</div>
<p><strong>2.</strong> <strong>编译服务器</strong>：</p>
<p>以下命令编译并启动虚幻引擎。每次您想要启动服务器或使用虚幻引擎编辑器时运行此命令：</p>
<div class="highlight"><pre><span></span><code><span class="w">    </span>make<span class="w"> </span>launch
</code></pre></div>
<p>该项目可能会要求构建其他实例，例如<code>UE4Editor-Carla.dll</code>第一次。同意才能打开项目。在首次启动期间，编辑器可能会显示有关着色器和网格距离场的警告。这些需要一些时间来加载，在此之前地图将无法正确显示。</p>
<p><strong>3.</strong> <strong>开始模拟</strong>：</p>
<p>按“运行”开始服务器模拟。可以使用<code>WASD</code>键移动相机，并通过在移动鼠标的同时单击场景来旋转相机。</p>
<p>使用<code>PythonAPI\examples</code>里面的示例脚本测试模拟器。在模拟器运行的情况下，为每个脚本打开一个新终端并运行以下命令以在城镇中产生一些生命并创建天气循环：</p>
<div class="highlight"><pre><span></span><code><span class="c1"># 终端 A </span>
<span class="nb">cd</span><span class="w"> </span>PythonAPI/examples
python3<span class="w"> </span>-m<span class="w"> </span>pip<span class="w"> </span>install<span class="w"> </span>-r<span class="w"> </span>requirements.txt
python3<span class="w"> </span>generate_traffic.py<span class="w">  </span>

<span class="c1"># 终端 B</span>
<span class="nb">cd</span><span class="w"> </span>PythonAPI/examples
python3<span class="w"> </span>dynamic_weather.py<span class="w"> </span>
</code></pre></div>
<div class="admonition 重要">
<p class="admonition-title">重要</p>
<p>如果模拟以非常低的 FPS 速率运行，请转至虚幻引擎编辑器中的<code>Edit -&gt; Editor preferences -&gt; Performance</code>并禁用 <code>Use less CPU when in background</code>。</p>
</div>
<h3 id="make">其他 make 命令 <span id="other-make-commands"></span></h3>
<p>您可能会发现还有更多有用的 <code>make</code> 命令。在下表中找到它们：</p>
<table>
<thead>
<tr>
<th>命令</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>make help</code></td>
<td>打印所有可用的命令。</td>
</tr>
<tr>
<td><code>make launch</code></td>
<td>在编辑器窗口中启动 Carla 服务器。</td>
</tr>
<tr>
<td><code>make PythonAPI</code></td>
<td>构建 Carla 客户端。</td>
</tr>
<tr>
<td><code>make LibCarla</code></td>
<td>准备将 Carla 库导入到任何地方。</td>
</tr>
<tr>
<td><code>make package</code></td>
<td>构建 Carla 并创建用于分发的打包版本。</td>
</tr>
<tr>
<td><code>make clean</code></td>
<td>删除构建系统生成的所有二进制文件和临时文件。</td>
</tr>
<tr>
<td><code>make rebuild</code></td>
<td><code>make clean</code> 和 <code>make launch</code> 两者都在一个命令中。</td>
</tr>
<tr>
<td><code>make check</code></td>
<td>进行单元测试</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="_7">其他 <span id="other"></span></h3>
<p>v2ray 的版本不能太高，比如可以使用 <a href="https://github.com/v2fly/v2ray-core/releases/tag/v4.45.2">v4.45.2</a> ，图形界面使用<a href="https://github.com/Qv2ray/Qv2ray/releases">Qv2ray 2.7.0</a> 。</p>
<h2 id="_8">问题</h2>
<ul>
<li>执行<code>make Python</code>时报错：</li>
</ul>
<p><code>A C++11 capable compiler is required for building the B2 engine.
Toolset 'clang' does not appear to support C++11.</code></p>
<hr />
<p>有关本指南的任何问题， 请阅读 <strong><a href="../build_faq/">常见问题解答</a></strong> 页面或<a href="https://github.com/carla-simulator/carla/discussions">Carla 论坛</a> 中的帖子。</p>
<p>接下来，学习如何更新 Carla 构建或在模拟中迈出第一步，并学习一些核心概念。</p>
<div class="build-buttons">

<p>
<a href="../build_update" target="_blank" class="btn btn-neutral" title="Learn how to update the build">
更新 Carla</a>
</p>

<p>
<a href="../core_concepts" target="_blank" class="btn btn-neutral" title="Learn about CARLA core concepts">
第一步</a>
</p>

</div>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      <script src="../js/umlconvert.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
