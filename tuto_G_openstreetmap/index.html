<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>使用 OpenStreetMap 生成地图 - 交通仿真文档</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u4f7f\u7528 OpenStreetMap \u751f\u6210\u5730\u56fe";
        var mkdocs_page_input_path = "tuto_G_openstreetmap.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 交通仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">入门</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../start_introduction/">介绍</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../start_quickstart/">快速启动包安装</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_first_steps/">第一步</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tutorials/">教程</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">构建 Carla</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../build_carla/">构建 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_linux/">Linux 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_windows/">Windows 上编译</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_update/">Carla 更新</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_system/">编译系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker/">Docker 中的 Carla</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_faq/">常问的问题</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 主题</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../foundations/">概念和基础</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_world/">第一、世界和客户端</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_actors/">第二、参与者和蓝图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_map/">第三、地图和导航 </a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../core_sensors/">第四、传感器和数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../development_tutorials/">开发</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../custom_assets_tutorials/">自定义资产</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_maps/">内容创作 - 地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_content_authoring_vehicles/">内容创作 - 车辆</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">交通仿真</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ts_traffic_simulation_overview/">交通</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_traffic_manager/">交通管理器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_sumo/">和 SUMO 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_scenic/">Scenic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">行人</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_walker_skeletons/">控制行人骨骼</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_pedestrian_navigation/">生成行人导航</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">高级概念</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_opendrive/">OpenDRIVE 独立模式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_recorder/">记录器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rendering_options/">渲染选项</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_rss/">责任敏感安全</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_synchrony_timestep/">同步和时间步长</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_benchmarking/">基准性能</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_agents/">Carla 智能体</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">资源</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../python_api/">Python API 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_cpp/">C++ 参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../bp_library/">蓝图库</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../catalogue/">Carla 目录</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_recorder_binary_file_format/">记录器二进制文件格式</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ref_sensors/">传感器参考</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ext_docs/">扩展文档</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">自定义地图</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_map_overview/">Carla 中自定义地图的概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_generate_map/">在 RoadRunner 中创建地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_package/">在 Carla 包导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_source/">在 Carla 源构建中导入地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_add_map_alternative/">导入地图的替代方法</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_manual_map_package/">手动准备地图包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_layers/">自定义地图：分层地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_add_tl/">自定义地图：红绿灯和标志</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_road_painter/">自定义地图：道路画家</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_weather_landscape/">自定义地图：天气和景观</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">使用 OpenStreetMap 生成地图</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#openstreetmap_1">使用 OpenStreetMap 导出地图</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#carla-openstreetmaps">在 Carla 中使用 OpenStreetMaps</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#openstreetmap-opendrive">将 OpenStreetMap 格式转换为 OpenDRIVE 格式</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#linux">Linux</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#windows">Windows</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#_1">生成交通灯</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#carla">导入 Carla</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#a">A) 使用您自己的脚本</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#b-xodr-configpy">B) 将 .xodr 传递给 config.py</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#c-osm-configpy">C) 将 .osm 传递给 config.py</a>
    </li>
        </ul>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_M_custom_buildings/">自定义地图：程序建筑</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_digital_twin/">数字孪生工具</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">大地图</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_overview/">大地图概述</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_roadrunner/">在RoadRunner中创建大地图</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../large_map_import/">导入/打包大地图</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（通用）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_add_friction_triggers/">添加摩擦触发器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_control_vehicle_physics/">控制车辆物理模型</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_retrieve_data/">检索仿真数据</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../build_docker_unreal/">在 Docker 中构建虚幻引擎和 Carla</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（资产）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_vehicle/">添加新车辆</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_add_props/">添加新道具</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_create_standalone/">创建独立包</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_A_material_customization/">材质定制</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">教程（开发人员）</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_contribute_assets/">如何升级内容</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_sensor/">创建一个传感器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_create_semantic_tags/">创建语义标签</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_customize_vehicle_suspension/">自定义车辆悬架</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_generate_colliders/">生成详细碰撞</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_make_release/">发布版本</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_D_windows_debug/">调试程序</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">示例</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_light/">交通灯的配置和使用</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_traffic_prediction/">流量预测</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Carla 生态系统</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_iss/">ISS 智能驾驶系统</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../plugins_carlaviz/">Web 可视化器</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ros_documentation/">ROS</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_femfx/">有限元变形材料虚幻插件</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_carsim_integration/">CarSim 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_rllib_integration/">RLlib 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_chrono/">Chrono 集成</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../OpenRadioss/use_OpenRadioss_windows/">OpenRadios 有限元仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../adv_ptv/">PTV-Vissim 联合仿真</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../ecosys_ansys/">Ansys 实时雷达模型</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/darkscyla/MATLAB-Carla-Interface">Matlab 接口</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../tuto_G_G29_windows/">罗技 G29 方向盘</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">贡献</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_contribution_guidelines/">贡献指南</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_code_of_conduct/">行为准则</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_coding_standard/">编码标准</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../cont_doc_standard/">文档标准</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">其他</span></p>
              <ul>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner/index.html">RoadRunner</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://ww2.mathworks.cn/help/roadrunner-scenario/index.html">RoadRunner Scenario</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://bbs.carla.org.cn/">Carla 中文站</a>
                  </li>
                  <li class="toctree-l1"><a class="" href="https://github.com/OpenHUTB/engine_doc">虚幻引擎教程</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../todo/">待做列表</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">交通仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">自定义地图</li>
      <li class="breadcrumb-item active">使用 OpenStreetMap 生成地图</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="openstreetmap">使用 OpenStreetMap 生成地图</h1>
<p>在本指南中，您将学习：</p>
<ul>
<li>如何从 OpenStreetMaps 导出地图。</li>
<li>Carla 中可以使用的不同格式的地图以及每种格式的限制。</li>
<li>如何将本机<code>.osm</code>格式转换为<code>.xodr</code>。</li>
<li>如何在<code>.xodr</code>文件中包含交通灯信息。</li>
<li>如何在 Carla 仿真中运行最终地图。</li>
</ul>
<p><a href="https://www.openstreetmap.org">OpenStreetMap</a> 是由数千名贡献者开发的开放数据世界地图，并根据<a href="https://opendatacommons.org/licenses/odbl/">Open Data Commons Open Database License</a> 获得许可。地图的各个部分可以导出为 XML 格式的<code>.osm</code>文件。Carla 可以将此文件转换为 OpenDRIVE 格式并使用 <a href="#adv_opendrive.md">OpenDRIVE Standalone Mode</a> 导入它。</p>
<ul>
<li><a href="#export-a-map-with-openstreetmap"><strong>使用 OpenStreetMap 导出地图</strong></a></li>
<li><a href="#using-openstreetmaps-in-carla"><strong>在 Carla 中使用 OpenStreetMaps</strong></a></li>
<li><a href="#convert-openstreetmap-format-to-opendrive-format"><strong>将 OpenStreetMap 格式转换为 OpenDRIVE 格式</strong></a><ul>
<li><a href="#linux">Linux</a></li>
<li><a href="#windows">Windows</a></li>
<li><a href="#generate-traffic-lights">生成交通灯</a></li>
</ul>
</li>
<li><a href="#ingest-into-carla"><strong>导入 Carla</strong></a></li>
</ul>
<hr />
<h2 id="openstreetmap_1">使用 OpenStreetMap 导出地图</h2>
<p>本节介绍如何从 Open Street Map 导出所需的地图信息：</p>
<p><strong>1.</strong> 导航至 <a href="https://www.openstreetmap.org">Open Street Map 网站</a> 。您将在窗口右侧看到地图视图和一个面板，您可以在其中配置不同的地图图层、查询不同的要素、切换图例等。</p>
<p><strong>2.</strong> 搜索您想要的位置并放大到特定区域。</p>
<p><img alt="openstreetmap_view" src="../img/tuto_g_osm_web.jpg" /></p>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>如果您想使用大范围的地图，例如巴黎，您可以考虑使用 Carla 的 <a href="../large_map_overview/"><strong>大地图功能</strong> </a> 。</p>
</div>
<p><strong>3.</strong> 单击窗口左上角的“导出( <em>Export</em> )”以打开“导出(<em>Export</em>)”面板。</p>
<p><strong>4.</strong> 单击“<em>导出</em>”面板中的“_手动_选择不同区域”。</p>
<p><strong>5.</strong> 通过拖动视口中方形区域的角来选择自定义区域。</p>
<p><strong>6.</strong> 单击导出面板中的 <em>导出</em> 按钮，将所选区域的地图信息保存为<code>.osm</code>文件。</p>
<p><img alt="openstreetmap_area" src="../img/tuto_g_osm_area.jpg" /></p>
<hr />
<h2 id="carla-openstreetmaps">在 Carla 中使用 OpenStreetMaps</h2>
<p>开放街道地图数据可以通过三种不同的方法在 Carla 中使用。您使用的方法取决于数据是否为原始格式，或者您是否使用以下部分中说明的转换方法来转换<code>.osm</code>文件。<code>.osm</code>保留文件是最受限制的方法，因为它不允许自定义设置。</p>
<p><strong>可用 <code>.xodr</code> 格式选项：</strong></p>
<ul>
<li>在您自己的脚本中生成地图。 <strong>该方法允许参数化。</strong></li>
<li>将文件作为参数传递给 Carla 的 <code>config.py</code>。 __ 此方法不允许参数化。__</li>
</ul>
<p><strong>可用 <code>.osm</code> 格式选项：</strong></p>
<ul>
<li>将文件作为参数传递给 Carla 的 <code>config.py</code>。 <strong>此方法不允许参数化。</strong></li>
</ul>
<p>以下部分将提供有关上面列出的选项的更多详细信息。</p>
<hr />
<h2 id="openstreetmap-opendrive">将 OpenStreetMap 格式转换为 OpenDRIVE 格式</h2>
<p>本节演示如何使用 Python API 将我们在上一节中导出的 <code>.osm</code> 文件转换为<code>.xodr</code>格式，以便可以在 Carla 中使用。</p>
<p><a href="../python_api/#carla.Osm2OdrSettings">carla.Osm2OdrSettings</a>类用于配置转换设置，例如偏移值、交通灯生成、原点坐标等。可配置参数的完整列表可以在 Python API <a href="../python_api/#carla.Osm2OdrSettings">文档</a> 中找到。<a href="../python_api/#carla.Osm2Odr">carla.Osm2Odr</a> 类使用这些设置来解析<code>.osm</code>数据并以 <code>.xodr</code> 格式输出。</p>
<p>在 Windows 中，<code>.osm</code>文件必须编码为<code>UTF-8</code>. 这在 Linux 中是不必要的。以下是示例代码片段，显示如何根据您的操作系统执行文件转换：</p>
<h5 id="linux">Linux</h5>
<pre><code class="language-py"># 读取 .osm 数据
f = open(&quot;path/to/osm/file&quot;, 'r')
osm_data = f.read()
f.close()

# 定义想要的设置。在该案例中为默认值。values.
settings = carla.Osm2OdrSettings()
# 设置导出到 OpenDRIVE 的 OSM 道路类型。
settings.set_osm_way_types([&quot;motorway&quot;, &quot;motorway_link&quot;, &quot;trunk&quot;, &quot;trunk_link&quot;, &quot;primary&quot;, &quot;primary_link&quot;, &quot;secondary&quot;, &quot;secondary_link&quot;, &quot;tertiary&quot;, &quot;tertiary_link&quot;, &quot;unclassified&quot;, &quot;residential&quot;])
# 转为 .xodr
xodr_data = carla.Osm2Odr.convert(osm_data, settings)

# 保存为 opendrive 文件
f = open(&quot;path/to/output/file&quot;, 'w')
f.write(xodr_data)
f.close()
</code></pre>
<h5 id="windows">Windows</h5>
<pre><code class="language-py">import io

# 读取 .osm 数据
f = io.open(&quot;test&quot;, mode=&quot;r&quot;, encoding=&quot;utf-8&quot;)
osm_data = f.read()
f.close()

# 定义想要的设置。在该案例中为默认值。
settings = carla.Osm2OdrSettings()
# 设置导出成 OpenDRIVE 的 OSM 道路类型
settings.set_osm_way_types([&quot;motorway&quot;, &quot;motorway_link&quot;, &quot;trunk&quot;, &quot;trunk_link&quot;, &quot;primary&quot;, &quot;primary_link&quot;, &quot;secondary&quot;, &quot;secondary_link&quot;, &quot;tertiary&quot;, &quot;tertiary_link&quot;, &quot;unclassified&quot;, &quot;residential&quot;])
# 转为 .xodr
xodr_data = carla.Osm2Odr.convert(osm_data, settings)

# 保存成 opendrive 文件
f = open(&quot;path/to/output/file&quot;, 'w')
f.write(xodr_data)
f.close()
</code></pre>
<p><br></p>
<hr />
<h3 id="_1">生成交通灯</h3>
<p>Open Street Map 数据可以定义哪些路口受交通灯控制。要在 Carla 中使用此交通灯数据，您需要在将<code>.osm</code>文件转换为<code>.xodr</code>格式之前通过 Python API 在 OSM 地图设置中启用它：</p>
<pre><code class="language-py"># 定义想要的设置。在该案例中为默认值。
settings = carla.Osm2OdrSettings()
# 启用从 OSM 数据中生成交通灯
settings.generate_traffic_lights = True
# 转为 .xodr
xodr_data = carla.Osm2Odr.convert(osm_data, settings)
</code></pre>
<p>交通灯数据质量可能因提取数据的区域而异。一些交通灯信息可能完全丢失。要克服这些限制，您可以使用 Python API 将所有路口配置为由交通灯控制：</p>
<pre><code class="language-py">settings.all_junctions_with_traffic_lights = True
</code></pre>
<p>您还可以排除某些道路（例如高速公路链接）生成交通信号灯：</p>
<pre><code>settings.set_traffic_light_excluded_way_types([&quot;motorway_link&quot;])
</code></pre>
<hr />
<h2 id="carla">导入 Carla</h2>
<p>本节介绍如何使用可用的不同选项，通过 <a href="../adv_opendrive/">OpenDRIVE 独立模式</a>将 Open Street Map 信息提取到 Carla 中。</p>
<p>有以下三个选项可供选择：</p>
<p><a href="#a-use-your-own-script"><strong>A)</strong></a> 使用您自己的自定义 Python 脚本中的转换 <code>.xodr</code> 文件 <strong>生成地图该方法允许参数化</strong>。 
<a href="#b-pass-xodr-to-configpy"><strong>B)</strong></a> 将转换后的<code>.xodr</code>文件作为参数传递给 Carla <code>config.py</code> 脚本。<strong>此方法不允许参数化。</strong>
<a href="#c-pass-osm-to-configpy"><strong>C)</strong></a> 将原始<code>.osm</code>文件作为参数传递给 Carla <code>config.py</code> 脚本。<strong>此方法不允许参数化。</strong></p>
<h6 id="a">A) 使用您自己的脚本</h6>
<p>生成新地图并阻止仿真，直到通过调用 <a href="../python_api/#carla.Client.generate_opendrive_world"><code>client.generate_opendrive_world()</code></a> 准备就绪。使用<a href="../python_api/#carla.OpendriveGenerationParameters">carla.OpendriveGenerationParameters</a>类配置网格生成。请参阅下面的示例：</p>
<pre><code class="language-py">vertex_distance = 2.0  # 以米为单位
max_road_length = 500.0 # 以米为单位
wall_height = 0.0      # 以米为单位
extra_width = 0.6      # 以米为单位
world = client.generate_opendrive_world(
    xodr_xml, carla.OpendriveGenerationParameters(
        vertex_distance=vertex_distance,
        max_road_length=max_road_length,
        wall_height=wall_height,
        additional_width=extra_width,
        smooth_junctions=True,
        enable_mesh_visibility=True))
</code></pre>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>强烈推荐<code>wall_height = 0.0</code>。OpenStreetMap 将相反方向的车道定义为不同的道路。如果生成墙壁，这将导致墙壁重叠和意外的碰撞。</p>
</div>
<h6 id="b-xodr-configpy">B) 将 <code>.xodr</code> 传递给 <code>config.py</code></h6>
<p>启动 Carla 服务器后，在单独的终端中运行以下命令来加载 Open Street Map：</p>
<pre><code class="language-sh">cd PythonAPI/util

python3 config.py -x=/path/to/xodr/file
</code></pre>
<p><a href="../python_api/#carla.OpendriveGenerationParameters">Default parameters</a> will be used.</p>
<h6 id="c-osm-configpy">C) 将 <code>.osm</code> 传递给 <code>config.py</code></h6>
<p>启动 Carla 服务器后，在单独的终端中运行以下命令来加载 Open Street Map：</p>
<pre><code class="language-sh">cd PythonAPI/util

python3 config.py --osm-path=/path/to/OSM/file
</code></pre>
<p>将使用<a href="../python_api/#carla.OpendriveGenerationParameters">默认参数</a>。 </p>
<p>无论使用哪种方法，地图都将被导入到 Carla 中，结果应类似于下图：</p>
<p><img alt="opendrive_meshissue" src="../img/tuto_g_osm_carla.jpg" />
<center> 使用 OpenStreetMap 生成 Carla 地图的结果。 </center></p>
<p><br></p>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>生成的道路在地图的边界处突然结束。当车辆无法找到下一个路径点时，这将导致交通管理器崩溃。为了避免这种情况，流量管理器中的 OSM 模式默认设置为True ( <a href="../python_api/#carlatrafficmanager"><code>set_osm_mode()</code></a> )。这将在必要时显示警告并摧毁车辆。</p>
</div>
<hr />
<p>与此主题相关的任何问题和疑问都可以在 Carla 论坛中发布。</p>
<div class="build-buttons">
<p>
<a href="https://github.com/carla-simulator/carla/discussions/" target="_blank" class="btn btn-neutral" title="Go to the CARLA forum">
Carla 论坛</a>
</p>
</div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../tuto_M_custom_weather_landscape/" class="btn btn-neutral float-left" title="自定义地图：天气和景观"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../tuto_M_custom_buildings/" class="btn btn-neutral float-right" title="自定义地图：程序建筑">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../tuto_M_custom_weather_landscape/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../tuto_M_custom_buildings/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
