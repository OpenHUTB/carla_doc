<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Sensor - äººè½¦æ¨¡æ‹Ÿå™¨</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Sensor";
        var mkdocs_page_input_path = "modules/sensor.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> äººè½¦æ¨¡æ‹Ÿå™¨
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">é¦–é¡µ</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">äººè½¦æ¨¡æ‹Ÿå™¨</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Sensor</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/modules/sensor.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="table-of-contents">ğŸ“‘ ç›®å½•ï¼ˆTable of Contentsï¼‰</h2>
<h3 id="sensorothercollision">ç¬¬ä¸€ç« ï¼šç¢°æ’äº‹ä»¶ä¼ æ„Ÿå™¨ï¼ˆsensor.other.collisionï¼‰</h3>
<ul>
<li><a href="#ç¬¬ä¸€ç« carla-ç¢°æ’äº‹ä»¶ä¼ æ„Ÿå™¨ç³»ç»Ÿsensorothercollision">ç¬¬ä¸€ç« ï¼šCARLA ç¢°æ’äº‹ä»¶ä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.collisionï¼‰</a></li>
<li><a href="#1-æ¨¡å—æ¦‚è§ˆ">1 æ¨¡å—æ¦‚è§ˆ</a></li>
<li><a href="#2-ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†">2 ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†</a></li>
<li><a href="#3-æ•°æ®ç»“æ„collisionevent">3 æ•°æ®ç»“æ„ï¼šCollisionEvent</a></li>
<li><a href="#4-åºåˆ—åŒ–å™¨åˆ†æcollisioneventserializer">4 åºåˆ—åŒ–å™¨åˆ†æ</a></li>
<li><a href="#5-rawdata-ä¸-sensordata-æ¦‚è¿°">5 RawData ä¸ SensorData æ¦‚è¿°</a></li>
<li><a href="#6-python-api-ä½¿ç”¨ç¤ºä¾‹">6 Python API ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#7-å°ç»“ä¸æ‹“å±•">7 å°ç»“ä¸æ‹“å±•</a></li>
</ul>
<h3 id="sensorothernoop">ç¬¬äºŒç« ï¼šç©ºä¼ æ„Ÿå™¨ï¼ˆsensor.other.noopï¼‰</h3>
<ul>
<li><a href="#ç¬¬äºŒç« carla-ç©ºä¼ æ„Ÿå™¨ç³»ç»Ÿsensorothernoop">ç¬¬äºŒç« ï¼šCARLA ç©ºä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.noopï¼‰</a></li>
<li><a href="#1-æ¨¡å—æ¦‚è§ˆ-1">1 æ¨¡å—æ¦‚è§ˆ</a></li>
<li><a href="#2-ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†-1">2 ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†</a></li>
<li><a href="#3-åºåˆ—åŒ–å™¨åˆ†ænoopserializer">3 åºåˆ—åŒ–å™¨åˆ†æ</a></li>
<li><a href="#4-æ•°æ®ç»“æ„ä¸ä¼ è¾“æœºåˆ¶">4 æ•°æ®ç»“æ„ä¸ä¼ è¾“æœºåˆ¶</a></li>
<li><a href="#5-python-api-ä½¿ç”¨ç¤ºä¾‹-1">5 Python API ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#6-å°ç»“ä¸æ‹“å±•-1">6 å°ç»“ä¸æ‹“å±•</a></li>
</ul>
<h3 id="imu-sensorotherimu">ç¬¬ä¸‰ç« ï¼šIMU ä¼ æ„Ÿå™¨ï¼ˆsensor.other.imuï¼‰</h3>
<ul>
<li><a href="#ç¬¬ä¸‰ç« carlaæƒ¯æ€§æµ‹é‡å•å…ƒä¼ æ„Ÿå™¨ç³»ç»Ÿsensorotherimu">ç¬¬ä¸‰ç« ï¼šCARLAæƒ¯æ€§æµ‹é‡å•å…ƒä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.imuï¼‰</a></li>
<li><a href="#1-æ¨¡å—æ¦‚è§ˆ-2">1 æ¨¡å—æ¦‚è§ˆ</a></li>
<li><a href="#2-å·¥ä½œæµç¨‹ä¸åºåˆ—åŒ–æœºåˆ¶">2 å·¥ä½œæµç¨‹ä¸åºåˆ—åŒ–æœºåˆ¶</a></li>
<li><a href="#3-æ•°æ®ç»“æ„è¯¦è§£">3 æ•°æ®ç»“æ„è¯¦è§£</a></li>
<li><a href="#4-python-api-è°ƒç”¨ç¤ºä¾‹">4 Python API è°ƒç”¨ç¤ºä¾‹</a></li>
<li><a href="#5-æ‹“å±•ç”¨ä¾‹ä¸é›†æˆåº”ç”¨">5 æ‹“å±•ç”¨ä¾‹ä¸é›†æˆåº”ç”¨</a></li>
<li><a href="#6-é™åˆ¶ä¸å¯¹æ¯”åˆ†æ">6 é™åˆ¶ä¸å¯¹æ¯”åˆ†æ</a></li>
<li><a href="#7-æ€»ç»“ä¸å»ºè®®-1">7 æ€»ç»“ä¸å»ºè®®</a></li>
</ul>
<h3 id="gnss-sensorothergnss">ç¬¬å››ç« ï¼šGNSS ä¼ æ„Ÿå™¨ï¼ˆsensor.other.gnssï¼‰</h3>
<ul>
<li><a href="#ç¬¬å››ç« carla-å…¨çƒå¯¼èˆªå«æ˜Ÿç³»ç»Ÿä¼ æ„Ÿå™¨sensorothergnss">ç¬¬å››ç« ï¼šCARLA å…¨çƒå¯¼èˆªå«æ˜Ÿç³»ç»Ÿä¼ æ„Ÿå™¨ï¼ˆsensor.other.gnssï¼‰</a></li>
<li><a href="#1-æ¨¡å—æ¦‚è§ˆ-3">1 æ¨¡å—æ¦‚è§ˆ</a></li>
<li><a href="#2-å·¥ä½œæµç¨‹ä¸ä¼ è¾“æœºåˆ¶">2 å·¥ä½œæµç¨‹ä¸ä¼ è¾“æœºåˆ¶</a></li>
<li><a href="#3-æ•°æ®ç»“æ„è§£æ">3 æ•°æ®ç»“æ„è§£æ</a></li>
<li><a href="#4-åºåˆ—åŒ–æœºåˆ¶åˆ†æ">4 åºåˆ—åŒ–æœºåˆ¶åˆ†æ</a></li>
<li><a href="#5-python-api-ä½¿ç”¨ç¤ºä¾‹-2">5 Python API ä½¿ç”¨ç¤ºä¾‹</a></li>
<li><a href="#6-åº”ç”¨æ‹“å±•ä¸ç»„åˆä½¿ç”¨">6 åº”ç”¨æ‹“å±•ä¸ç»„åˆä½¿ç”¨</a></li>
<li><a href="#7-æ€»ç»“ä¸å»ºè®®-2">7 æ€»ç»“ä¸å»ºè®®</a></li>
</ul>
<hr />
<h1 id="carla-sensorothercollision">ç¬¬ä¸€ç« ï¼šCARLA ç¢°æ’äº‹ä»¶ä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.collisionï¼‰</h1>
<hr />
<h2 id="1">1 æ¨¡å—æ¦‚è§ˆ</h2>
<p><img alt="flowchart_1.png" src="../../img/modules/flowchart_1.png" /></p>
<p>æœ¬ç« è¯¦ç»†è®²è§£ CARLA æ¨¡æ‹Ÿå™¨ä¸­çš„ä¸€ç±»ç®€å•ä¼ æ„Ÿå™¨ï¼š<code>sensor.other.collision</code>ï¼Œå³ç¢°æ’äº‹ä»¶ä¼ æ„Ÿå™¨ã€‚è¯¥ä¼ æ„Ÿå™¨ä¸è¾“å‡ºè¿ç»­çš„æ•°æ®æµä¿¡æ¯ï¼Œè€Œæ˜¯åœ¨æ£€æµ‹åˆ°å®ä½“ç¢°æ’æ—¶ä»¥äº‹ä»¶å½¢å¼å³æ—¶è§¦å‘ã€‚å…¶è®¾è®¡åˆè¡·æ˜¯ä¸ºç”¨æˆ·æä¾›è½¦è¾†ä¸ç¯å¢ƒä¸­å…¶ä»–å¯¹è±¡ä¹‹é—´ç‰©ç†äº¤äº’çš„ç›‘æ§èƒ½åŠ›ã€‚</p>
<p>åœ¨è‡ªåŠ¨é©¾é©¶ä»¿çœŸã€å¼ºåŒ–å­¦ä¹ å®‰å…¨è¯„ä¼°æˆ–ç¢°æ’è§„é¿ç®—æ³•éªŒè¯ä¸­ï¼Œ<code>sensor.other.collision</code> æä¾›äº†å…³é”®çš„åé¦ˆä¿¡å·ã€‚é€šè¿‡å¯¹å…¶æ•°æ®ç»“æ„ã€åºåˆ—åŒ–æœºåˆ¶ä¸å®¢æˆ·ç«¯å›è°ƒè§¦å‘æµç¨‹çš„æ·±å…¥è§£æï¼Œå¯å…¨é¢ç†è§£è¯¥ä¼ æ„Ÿå™¨åœ¨ CARLA æ„ŸçŸ¥ç³»ç»Ÿä¸­çš„è¿è¡Œæœºåˆ¶åŠå…¶å·¥ç¨‹å®ç°ã€‚</p>
<hr />
<h2 id="2">2 ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†</h2>
<p>CARLA æ‰€æœ‰ä¼ æ„Ÿå™¨ï¼ŒåŒ…æ‹¬ <code>sensor.other.collision</code>ï¼Œå‡åŸºäºç»Ÿä¸€çš„ Actor æ³¨å†Œä¸ç»‘å®šæ¡†æ¶ã€‚å…¶åˆ›å»ºä¸å·¥ä½œæµç¨‹å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ ¸å¿ƒé˜¶æ®µï¼š</p>
<ul>
<li><strong>è“å›¾æ³¨å†Œé˜¶æ®µ</strong>ï¼šCARLA æ‰€æœ‰ä¼ æ„Ÿå™¨ç±»å‹åœ¨ Unreal Engine çš„è“å›¾ç³»ç»Ÿä¸­å®šä¹‰ï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚</li>
<li><strong>Actor åˆ›å»ºé˜¶æ®µ</strong>ï¼šPython å®¢æˆ·ç«¯é€šè¿‡ <code>world.spawn_actor()</code> åˆ›å»º <code>"sensor.other.collision"</code> å®ä¾‹ã€‚</li>
<li><strong>ä¼ æ„Ÿå™¨é€šé“å»ºç«‹</strong>ï¼šActor è‡ªåŠ¨ç»‘å®šåº•å±‚çš„ <code>SensorData</code> æ•°æ®ç±»å‹ï¼Œç”¨æˆ·é€šè¿‡ <code>.listen()</code> æ³¨å†Œäº‹ä»¶å¤„ç†å‡½æ•°ã€‚</li>
<li><strong>äº‹ä»¶è§¦å‘ä¸ä¼ è¾“æœºåˆ¶</strong>ï¼š</li>
<li>æœåŠ¡ç«¯ç”Ÿæˆ <code>CollisionEvent</code> äº‹ä»¶ï¼ˆBullet å¼•æ“ï¼‰</li>
<li>ä½¿ç”¨ <a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/s11n/CollisionEventSerializer.h"><code>CollisionEventSerializer</code></a> ç¼–ç ä¸º <code>RawData</code></li>
<li>é€šè¿‡ RPC ç½‘ç»œå‘é€</li>
<li>å®¢æˆ·ç«¯ä½¿ç”¨ <code>Deserialize()</code> è§£ç ä¸º <code>SensorData</code></li>
<li>æ³¨å…¥å›è°ƒå‡½æ•°ä¸­è¿›è¡Œå¤„ç†
è¯¥æµç¨‹æ„æˆäº‹ä»¶æ•æ‰ â†’ æ•°æ®åºåˆ—åŒ– â†’ ç½‘ç»œä¼ è¾“ â†’ è§£ç è¿˜åŸ â†’ å®¢æˆ·ç«¯å¤„ç†çš„å®Œæ•´é€šè·¯ã€‚</li>
</ul>
<hr />
<h2 id="3-collisionevent">3 æ•°æ®ç»“æ„ï¼šCollisionEvent</h2>
<p>å®šä¹‰æ–‡ä»¶ï¼š<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/data/CollisionEvent.h"><code>carla/sensor/data/CollisionEvent.h</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">CollisionEvent</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">self_actor</span><span class="p">;</span>
<span class="w">  </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">other_actor</span><span class="p">;</span>
<span class="w">  </span><span class="n">geom</span><span class="o">::</span><span class="n">Vector3D</span><span class="w"> </span><span class="n">normal_impulse</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<ul>
<li><code>self_actor</code>ï¼šä¼ æ„Ÿå™¨é™„ç€å®ä½“ï¼ˆå¦‚è½¦è¾†ï¼‰</li>
<li><code>other_actor</code>ï¼šç¢°æ’å¯¹è±¡ï¼ˆå¦‚éšœç¢ç‰©ã€NPCï¼‰</li>
<li><code>normal_impulse</code>ï¼šå†²å‡»åŠ›çŸ¢é‡ï¼Œåæ˜ ç¢°æ’å¼ºåº¦ä¸æ–¹å‘</li>
</ul>
<hr />
<h2 id="4-collisioneventserializer">4 åºåˆ—åŒ–å™¨åˆ†æï¼šCollisionEventSerializer</h2>
<p>å®šä¹‰æ–‡ä»¶ï¼š<br />
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/s11n/CollisionEventSerializer.h"><code>CollisionEventSerializer.h</code></a><br />
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/s11n/CollisionEventSerializer.cpp"><code>CollisionEventSerializer.cpp</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">Data</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">self_actor</span><span class="p">;</span>
<span class="w">  </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">other_actor</span><span class="p">;</span>
<span class="w">  </span><span class="n">geom</span><span class="o">::</span><span class="n">Vector3D</span><span class="w"> </span><span class="n">normal_impulse</span><span class="p">;</span>
<span class="w">  </span><span class="n">MSGPACK_DEFINE_ARRAY</span><span class="p">(</span><span class="n">self_actor</span><span class="p">,</span><span class="w"> </span><span class="n">other_actor</span><span class="p">,</span><span class="w"> </span><span class="n">normal_impulse</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">template</span><span class="w"> </span><span class="o">&lt;</span><span class="k">typename</span><span class="w"> </span><span class="nc">SensorT</span><span class="o">&gt;</span>
<span class="k">static</span><span class="w"> </span><span class="n">Buffer</span><span class="w"> </span><span class="n">Serialize</span><span class="p">(</span>
<span class="w">    </span><span class="k">const</span><span class="w"> </span><span class="n">SensorT</span><span class="w"> </span><span class="o">&amp;</span><span class="p">,</span>
<span class="w">    </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">self_actor</span><span class="p">,</span>
<span class="w">    </span><span class="n">rpc</span><span class="o">::</span><span class="n">Actor</span><span class="w"> </span><span class="n">other_actor</span><span class="p">,</span>
<span class="w">    </span><span class="n">geom</span><span class="o">::</span><span class="n">Vector3D</span><span class="w"> </span><span class="n">normal_impulse</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">MsgPack</span><span class="o">::</span><span class="n">Pack</span><span class="p">(</span><span class="n">Data</span><span class="p">{</span><span class="n">self_actor</span><span class="p">,</span><span class="w"> </span><span class="n">other_actor</span><span class="p">,</span><span class="w"> </span><span class="n">normal_impulse</span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="k">static</span><span class="w"> </span><span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Deserialize</span><span class="p">(</span><span class="n">RawData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">data</span><span class="o">::</span><span class="n">CollisionEvent</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">data</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<hr />
<h2 id="5-rawdata-sensordata">5 RawData ä¸ SensorData æ¦‚è¿°</h2>
<p>æ•°æ®ç»“æ„å®šä¹‰ï¼š<br />
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/RawData.h"><code>RawData.h</code></a><br />
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/SensorData.h"><code>SensorData.h</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">RawData</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="n">GetFrame</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="nf">GetTimestamp</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="n">rpc</span><span class="o">::</span><span class="n">Transform</span><span class="w"> </span><span class="o">&amp;</span><span class="nf">GetSensorTransform</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="k">const</span><span class="w"> </span><span class="kt">uint8_t</span><span class="w"> </span><span class="o">*</span><span class="nf">begin</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="kt">size_t</span><span class="w"> </span><span class="nf">size</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SensorData</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">EnableSharedFromThis</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="p">,</span><span class="w"> </span><span class="k">private</span><span class="w"> </span><span class="n">NonCopyable</span><span class="w"> </span><span class="p">{</span>
<span class="k">protected</span><span class="o">:</span>
<span class="w">  </span><span class="n">SensorData</span><span class="p">(</span><span class="kt">size_t</span><span class="w"> </span><span class="n">frame</span><span class="p">,</span><span class="w"> </span><span class="kt">double</span><span class="w"> </span><span class="n">timestamp</span><span class="p">,</span><span class="w"> </span><span class="k">const</span><span class="w"> </span><span class="n">rpc</span><span class="o">::</span><span class="n">Transform</span><span class="w"> </span><span class="o">&amp;</span><span class="n">sensor_transform</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<hr />
<h2 id="6-python-api">6 Python API ä½¿ç”¨ç¤ºä¾‹</h2>
<p>å‚è€ƒæ–‡ä»¶ï¼š<a href="https://github.com/OpenHUTB/carla_doc/blob/dev/src/examples/collision_sensor.py"><code>collision_sensor.py</code></a></p>
<div class="highlight"><pre><span></span><code>def on_collision(event):
    actor = event.other_actor
    impulse = event.normal_impulse
    print(f&quot;å‘ç”Ÿç¢°æ’ï¼å¯¹è±¡ç±»å‹ï¼š{actor.type_id}ï¼Œå†²å‡»å‘é‡ï¼š{impulse}&quot;)
</code></pre></div>
<div class="highlight"><pre><span></span><code>blueprint_library = world.get_blueprint_library()
bp = blueprint_library.find(&#39;sensor.other.collision&#39;)
transform = carla.Transform(carla.Location(x=0, y=0, z=2.0))
sensor = world.spawn_actor(bp, transform, attach_to=vehicle)
sensor.listen(on_collision)
</code></pre></div>
<hr />
<h2 id="7">7 å°ç»“ä¸æ‹“å±•</h2>
<ul>
<li><code>sensor.other.collision</code> æ˜¯è½»é‡ã€äº‹ä»¶é©±åŠ¨çš„ä¼ æ„Ÿå™¨</li>
<li>ä½¿ç”¨ <code>MsgPack + RawData</code> ç»„åˆï¼Œç¼–ç æ•ˆç‡é«˜</li>
<li>å¸¸ç”¨äºï¼šç¢°æ’æ£€æµ‹ã€äº‹æ•…åˆ†æã€æƒ©ç½šä¿¡å·ç”Ÿæˆ</li>
</ul>
<h3 id="_1">å¯æ‹“å±•æ–¹å‘ï¼š</h3>
<ul>
<li>å¢åŠ å­—æ®µï¼ˆå¦‚é€Ÿåº¦å‘é‡ã€ç¢°æ’ä½ç½®ï¼‰</li>
<li>ç»“åˆå›¾åƒã€GNSS æ•°æ®å®ç°å›æº¯ç³»ç»Ÿ</li>
<li>ä¸å¼ºåŒ–å­¦ä¹ ç»“åˆç”ŸæˆåŠ¨æ€è§„é¿ç­–ç•¥</li>
</ul>
<hr />
<h1 id="carla-sensorothernoop">ç¬¬äºŒç« ï¼šCARLA ç©ºä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.noopï¼‰</h1>
<hr />
<h2 id="1_1">1 æ¨¡å—æ¦‚è§ˆ</h2>
<p><img alt="flowchart_2.png" src="../../img/modules/flowchart_2.png" /></p>
<p>æœ¬ç« ä»‹ç» CARLA æ¨¡æ‹Ÿå™¨ä¸­æœ€ä¸ºç®€åŒ–çš„ä¸€ç±»ä¼ æ„Ÿå™¨ï¼š<code>sensor.other.noop</code>ï¼Œå³â€œæ— æ“ä½œä¼ æ„Ÿå™¨â€ï¼ˆNo-Operation Sensorï¼‰ã€‚é¡¾åæ€ä¹‰ï¼Œè¯¥ä¼ æ„Ÿå™¨ä¸ä¼šå‘å®¢æˆ·ç«¯å‘é€ä»»ä½•æ•°æ®ï¼Œå…¶å­˜åœ¨çš„æ„ä¹‰æ›´å¤šæ˜¯ä½œä¸ºå®¢æˆ·ç«¯æŒ‚è½½ä¼ æ„Ÿå™¨çš„å ä½ç¬¦ã€åŠŸèƒ½æµ‹è¯•å™¨æˆ–æ–°ä¼ æ„Ÿå™¨å¼€å‘çš„æœ€å°æ¨¡æ¿ã€‚</p>
<p><code>sensor.other.noop</code> é€‚ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>æ„å»ºæ–°å‹ä¼ æ„Ÿå™¨æ—¶çš„èµ·å§‹æ¨¡æ¿ï¼›</li>
<li>ç”¨äºç½‘ç»œä¸å›è°ƒæœºåˆ¶è°ƒè¯•ï¼Œæ— éœ€å®é™…æ•°æ®ï¼›</li>
<li>å ä½ä¼ æ„Ÿå™¨ï¼ˆéœ€è¦ç»‘å®šä½†æš‚æ—¶ä¸äº§å‡ºæ•°æ®ï¼‰ï¼›</li>
<li>æ¨¡æ‹Ÿä¼ æ„Ÿå™¨å¤±è´¥æˆ–æ— å“åº”åœºæ™¯ä¸‹çš„ç³»ç»Ÿè¡Œä¸ºã€‚</li>
</ul>
<p>å…¶æ ¸å¿ƒç‰¹å¾æ˜¯ï¼š<strong>ä¸å‚ä¸æ•°æ®æµçš„ä»»ä½•é˜¶æ®µ</strong>ï¼ŒæœåŠ¡ç«¯ä¸ä¼šæ¨é€æ•°æ®ï¼Œå®¢æˆ·ç«¯æ¥æ”¶åˆ°æ•°æ®åˆ™ç«‹å³æŠ¥é”™ã€‚</p>
<hr />
<h2 id="2_1">2 ä¼ æ„Ÿå™¨æ³¨å†Œä¸è°ƒç”¨åŸç†</h2>
<p><code>sensor.other.noop</code> éµå¾ª CARLA æ‰€æœ‰ä¼ æ„Ÿå™¨ç»Ÿä¸€çš„æ³¨å†Œã€æŒ‚è½½ã€é€šä¿¡æ¡†æ¶ï¼Œå…¶è°ƒç”¨æµç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p>
<ul>
<li><strong>è“å›¾æ³¨å†Œé˜¶æ®µ</strong>ï¼šè¯¥ä¼ æ„Ÿå™¨åœ¨ Unreal Engine è“å›¾ç³»ç»Ÿä¸­ä»¥ <code>"sensor.other.noop"</code> æ³¨å†Œï¼Œè“å›¾åº“ä¸­åŒ…å«å…¶ç±»å‹å®šä¹‰ã€‚</li>
<li><strong>Actor åˆ›å»ºé˜¶æ®µ</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡ <code>world.spawn_actor()</code> åˆ›å»ºè¯¥ä¼ æ„Ÿå™¨å®ä¾‹ï¼Œä¼ å…¥ <code>"sensor.other.noop"</code> å­—ç¬¦ä¸²ä½œä¸ºè“å›¾ IDï¼Œå®ä¾‹å¯é™„ç€è‡³è½¦è¾†æˆ–åŠ¨æ€å¯¹è±¡ã€‚</li>
<li><strong>ä¼ æ„Ÿå™¨ç›‘å¬ç»‘å®š</strong>ï¼š</li>
<li>å¯é€šè¿‡ <code>.listen()</code> æ³¨å†Œ Python å›è°ƒå‡½æ•°ï¼›</li>
<li>ä½†ç”±äºæ­¤ä¼ æ„Ÿå™¨ä¸ä¼šç”Ÿæˆä»»ä½•äº‹ä»¶ï¼Œå›è°ƒå‡½æ•°æ°¸è¿œä¸ä¼šè¢«å®é™…è°ƒç”¨ï¼›</li>
<li>è‹¥æ•°æ®è¿›å…¥ç³»ç»Ÿï¼Œå°†ç”±åºåˆ—åŒ–å™¨ç›´æ¥æ‹’ç»å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚</li>
</ul>
<hr />
<h2 id="3-noopserializer">3 åºåˆ—åŒ–å™¨åˆ†æï¼šNoopSerializer</h2>
<p>è¯¥åºåˆ—åŒ–å™¨ä¸“ä¸ºâ€œå®¢æˆ·ç«¯ä¸æ¥æ”¶æ•°æ®â€çš„ä¼ æ„Ÿå™¨è®¾è®¡ï¼Œæ ¸å¿ƒé€»è¾‘æ˜¯ç¦æ­¢ä»»ä½•æ•°æ®ååºåˆ—åŒ–ã€‚</p>
<h3 id="31">3.1 æ¥å£å®šä¹‰</h3>
<div class="highlight"><pre><span></span><code><span class="c1">/// Dummy serializer that blocks all the data.</span>
<span class="k">class</span><span class="w"> </span><span class="nc">NoopSerializer</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="p">[[</span><span class="n">noreturn</span><span class="p">]]</span><span class="w"> </span><span class="k">static</span><span class="w"> </span><span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Deserialize</span><span class="p">(</span><span class="n">RawData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">data</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>
<p>è¯´æ˜ï¼š</p>
<ul>
<li><code>[[noreturn]]</code> æ˜¯ C++11 æ ‡å‡†ä¿®é¥°ç¬¦ï¼Œè¡¨ç¤ºè¯¥å‡½æ•°æ°¸ä¸è¿”å›ï¼›</li>
<li>è°ƒç”¨è¯¥å‡½æ•°å°†æŠ›å‡ºå¼‚å¸¸ï¼Œæ ‡å¿—è¯¥ä¼ æ„Ÿå™¨è®¾è®¡ä¸ºâ€œä¸å¯ååºåˆ—åŒ–â€ã€‚</li>
</ul>
<h3 id="32">3.2 å‡½æ•°å®ç°</h3>
<div class="highlight"><pre><span></span><code><span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">NoopSerializer</span><span class="o">::</span><span class="n">Deserialize</span><span class="p">(</span><span class="n">RawData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">throw_exception</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">runtime_error</span><span class="p">(</span><span class="s">&quot;NoopSerializer: Invalid data received.&quot;</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<p>è¯´æ˜ï¼š</p>
<ul>
<li>ä½¿ç”¨ CARLA æä¾›çš„ <code>throw_exception</code> å·¥å…·å‡½æ•°ï¼›</li>
<li>ä¸€æ—¦å®¢æˆ·ç«¯å°è¯•å¤„ç†æ­¤ç±»å‹æ•°æ®ï¼Œå³è§¦å‘ä¸­æ–­é”™è¯¯ï¼›</li>
<li>è¯¥æœºåˆ¶ç¡®ä¿ <code>sensor.other.noop</code> æ— æ³•è¢«è¯¯ç”¨ã€‚</li>
</ul>
<hr />
<h2 id="4">4 æ•°æ®ç»“æ„ä¸ä¼ è¾“æœºåˆ¶</h2>
<p>è¯¥ä¼ æ„Ÿå™¨ä¸ç»‘å®šä»»ä½•ç»“æ„åŒ–æ•°æ®ç±»å‹ï¼š</p>
<ul>
<li>ä¸åŒ…å«è‡ªå®šä¹‰æ•°æ®ç»“æ„ï¼ˆå¦‚ <code>NoopEvent</code>ï¼‰ï¼›</li>
<li>ä¸é€šè¿‡ <code>RawData</code> ä¼ è¾“ä»»ä½•å†…å®¹ï¼›</li>
<li>æ— æœ‰æ•ˆ <code>SensorData</code> æ´¾ç”Ÿç±»å®ä¾‹ç”Ÿæˆï¼›</li>
<li>è™½ç„¶æ”¯æŒ <code>.listen()</code> æ³¨å†Œæœºåˆ¶ï¼Œä½†æ°¸ä¸è§¦å‘ã€‚</li>
</ul>
<p>å› æ­¤ï¼Œ<code>sensor.other.noop</code> æ˜¯ä¸€ç§â€œå­˜åœ¨ä½†ä¸å‘å£°â€çš„ä¼ æ„Ÿå™¨ï¼Œä»…ç”¨äºæŒ‚è½½å ä½æˆ–è°ƒè¯•ç›®çš„ã€‚</p>
<hr />
<h2 id="5-python-api">5 Python API ä½¿ç”¨ç¤ºä¾‹</h2>
<p>è™½ç„¶è¯¥ä¼ æ„Ÿå™¨ä¸ä¼ è¾“æ•°æ®ï¼Œä»å¯æ­£å¸¸åœ¨ Python ä¸­åˆ›å»ºä¸æ³¨å†Œç›‘å¬ã€‚</p>
<div class="highlight"><pre><span></span><code># å®šä¹‰å›è°ƒå‡½æ•°ï¼ˆæ³¨æ„ï¼šä¸ä¼šè¢«è°ƒç”¨ï¼‰
def on_noop_event(event):
    print(&quot;æ­¤å¤„ä¸åº”å‡ºç°ä»»ä½•è¾“å‡º&quot;)

# è·å–è“å›¾åº“å¹¶æŸ¥æ‰¾è“å›¾
bp = world.get_blueprint_library().find(&#39;sensor.other.noop&#39;)

# è®¾ç½®ä¼ æ„Ÿå™¨ç›¸å¯¹ä½ç½®
transform = carla.Transform(carla.Location(x=0, y=0, z=2.0))

# åˆ›å»ºä¼ æ„Ÿå™¨å¹¶é™„ç€è‡³è½¦è¾†
noop_sensor = world.spawn_actor(bp, transform, attach_to=vehicle)

# æ³¨å†Œç›‘å¬å‡½æ•°ï¼ˆå°†ä¸ä¼šè§¦å‘ï¼‰
noop_sensor.listen(on_noop_event)
</code></pre></div>
<p><strong>å¯é€‰è°ƒè¯•å»ºè®®</strong>ï¼š</p>
<ul>
<li>å¯ç”¨æ—¥å¿—éªŒè¯ä¼ æ„Ÿå™¨æŒ‚è½½æˆåŠŸï¼›</li>
<li>å¯è°ƒç”¨ <code>.destroy()</code> è§‚å¯Ÿé”€æ¯é€»è¾‘ï¼›</li>
<li>å¯ç»„åˆå¤šä¸ªä¼ æ„Ÿå™¨è§‚å¯Ÿ <code>.listen()</code> æœºåˆ¶è¡Œä¸ºã€‚</li>
</ul>
<hr />
<h2 id="6">6 å°ç»“ä¸æ‹“å±•</h2>
<ul>
<li><code>sensor.other.noop</code> æ˜¯ CARLA ä¸­ç»“æ„æœ€ç®€ã€ç”¨é€”æœ€ç‰¹æ®Šçš„ä¸€ç±»ä¼ æ„Ÿå™¨ï¼›</li>
<li>å…¶æ ¸å¿ƒè®¾è®¡ç›®çš„æ˜¯ï¼šç¦æ­¢æ•°æ®æµé€šï¼Œä»…åšå ä½å’Œè°ƒè¯•ï¼›</li>
<li>éå¸¸é€‚åˆä½œä¸ºè‡ªå®šä¹‰ä¼ æ„Ÿå™¨çš„å¼€å‘æ¨¡æ¿æˆ–åºåˆ—åŒ–é“¾æµ‹è¯•å·¥å…·ã€‚</li>
</ul>
<h3 id="_2">æ‹“å±•å»ºè®®ï¼š</h3>
<ul>
<li>ä½œä¸ºæ–°äº‹ä»¶ä¼ æ„Ÿå™¨çš„èµ·ç‚¹æ¨¡æ¿ï¼›</li>
<li>ç”¨äºæµ‹è¯• <code>.listen()</code> å’Œ <code>.destroy()</code> å›è°ƒæµç¨‹ï¼›</li>
<li>æ¨¡æ‹Ÿä¼ æ„Ÿå™¨æ•…éšœã€å¼‚å¸¸æˆ–ä¸¢åŒ…å¤„ç†æœºåˆ¶ï¼›</li>
<li>å¯ç»„åˆå›¾åƒã€IMU ç­‰å®é™…ä¼ æ„Ÿå™¨æµ‹è¯•æ˜¯å¦å‘ç”Ÿè°ƒç”¨ç«äº‰æˆ–ç³»ç»Ÿå†²çªã€‚</li>
</ul>
<hr />
<h1 id="carlasensorotherimu">ç¬¬ä¸‰ç« ï¼šCARLAæƒ¯æ€§æµ‹é‡å•å…ƒä¼ æ„Ÿå™¨ç³»ç»Ÿï¼ˆsensor.other.imuï¼‰</h1>
<hr />
<h2 id="1_2">1 æ¨¡å—æ¦‚è§ˆ</h2>
<p><img alt="flowchart_3.png" src="../../img/modules/flowchart_3.png" /></p>
<p><code>sensor.other.imu</code> æ˜¯ CARLA æä¾›çš„æƒ¯æ€§æµ‹é‡å•å…ƒï¼ˆIMUï¼‰ä¼ æ„Ÿå™¨ï¼Œç”¨äºæ•æ‰è½¦è¾†çš„ä¸‰ç»´åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦åŠæ–¹å‘ä¿¡æ¯ï¼Œå¹¿æ³›åº”ç”¨äºè½¨è¿¹ä¼°è®¡ã€å§¿æ€è§£ç®—ã€å¯¼èˆªèåˆç­‰è‡ªåŠ¨é©¾é©¶ä»¿çœŸä»»åŠ¡ä¸­ã€‚</p>
<p>è¯¥ä¼ æ„Ÿå™¨ä¼šå‘¨æœŸæ€§å‘é€äº‹ä»¶ï¼Œä¼ é€’ä»¥ä¸‹æ•°æ®ï¼š</p>
<ul>
<li><strong>åŠ é€Ÿåº¦è®¡</strong>ï¼šä¸‰è½´åŠ é€Ÿåº¦ <code>Vector3D(x, y, z)</code>ï¼Œå•ä½ m/sÂ²</li>
<li><strong>é™€èºä»ª</strong>ï¼šä¸‰è½´è§’é€Ÿåº¦ <code>Vector3D(x, y, z)</code>ï¼Œå•ä½ rad/s</li>
<li><strong>ç½—ç›˜</strong>ï¼šèˆªå‘è§’ï¼ˆæ–¹å‘æœå‘ï¼‰ï¼Œå•ä½å¼§åº¦</li>
</ul>
<p>é»˜è®¤ä»¥ 20Hz æ›´æ–°é¢‘ç‡è¾“å‡ºï¼Œæ”¯æŒåœ¨è“å›¾ä¸­è°ƒæ•´é‡‡æ ·é€Ÿç‡ã€‚</p>
<hr />
<h2 id="2_2">2 å·¥ä½œæµç¨‹ä¸åºåˆ—åŒ–æœºåˆ¶</h2>
<p>IMU ä¼ æ„Ÿå™¨çš„æ•°æ®æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äº‹ä»¶æ•è·</strong>ï¼šæ¨¡æ‹Ÿå™¨æœåŠ¡ç«¯é‡‡é›†å½“å‰å¸§çš„ IMU æ•°æ®</li>
<li><strong>æ•°æ®åºåˆ—åŒ–</strong>ï¼šä½¿ç”¨ <code>IMUSerializer</code> å°†åŠ é€Ÿåº¦ã€è§’é€Ÿåº¦ä¸ç½—ç›˜å€¼æ‰“åŒ…ä¸º MsgPack ç¼–ç å­—èŠ‚æµï¼ˆå‚è§ <code>IMUSerializer.h/.cpp</code>ï¼‰</li>
<li><strong>ç½‘ç»œä¼ è¾“</strong>ï¼šæ‰“åŒ…åçš„ <code>RawData</code> é€šè¿‡ RPC ç³»ç»Ÿä¼ è¾“è‡³å®¢æˆ·ç«¯</li>
<li><strong>æ•°æ®è¿˜åŸ</strong>ï¼šå®¢æˆ·ç«¯é€šè¿‡ <code>IMUMeasurement</code> ç±»å°†å­—èŠ‚æµè¿˜åŸä¸ºç»“æ„åŒ–å¯¹è±¡</li>
<li><strong>å›è°ƒè§¦å‘</strong>ï¼šPython å±‚æ³¨å†Œçš„ <code>.listen()</code> å›è°ƒå‡½æ•°è·å¾—è¯¥äº‹ä»¶å¹¶æ‰§è¡Œå¤„ç†é€»è¾‘</li>
</ol>
<hr />
<h2 id="3">3 æ•°æ®ç»“æ„è¯¦è§£</h2>
<p>IMU æ•°æ®é€šè¿‡ <code>IMUMeasurement</code> ç±»å¯¹å¤–æš´éœ²ï¼Œå®šä¹‰ä½ç½®ï¼š</p>
<p>ğŸ“„ <a href="https://github.com/carla-simulator/carla/blob/dev/LibCarla/source/carla/sensor/data/IMUMeasurement.h"><code>carla/sensor/data/IMUMeasurement.h</code></a></p>
<p>è¯¥ç±»å°è£…å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code>class IMUMeasurement : public SensorData {
public:
  geom::Vector3D GetAccelerometer() const;
  geom::Vector3D GetGyroscope() const;
  float GetCompass() const;
};
</code></pre></div>
<ul>
<li><strong>åŠ é€Ÿåº¦</strong>ï¼šIMU åŠ é€Ÿåº¦è®¡æµ‹å¾—çš„ä¸‰è½´å€¼</li>
<li><strong>è§’é€Ÿåº¦</strong>ï¼šé™€èºä»ªè§’é€Ÿåº¦</li>
<li><strong>ç½—ç›˜å€¼</strong>ï¼šèˆªå‘è§’ï¼ˆé€šå¸¸ä¸º 0\~2Ï€ çš„å¼§åº¦ï¼‰</li>
</ul>
<p>æ‰€æœ‰å­—æ®µé€šè¿‡ <code>IMUSerializer::Deserialize()</code> æ–¹æ³•ä» <code>RawData</code> è¿˜åŸï¼Œåºåˆ—åŒ–ç»“æ„å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre><span></span><code>struct IMUData {
  Vector3D accelerometer;
  Vector3D gyroscope;
  float compass;
};
</code></pre></div>
<p>é€šè¿‡ <code>MSGPACK_DEFINE_ARRAY(acc, gyro, compass)</code> æ”¯æŒ MsgPack è‡ªåŠ¨ç¼–ç ã€‚</p>
<hr />
<h2 id="4-python-api">4 Python API è°ƒç”¨ç¤ºä¾‹</h2>
<p>ä»¥ä¸‹ä»£ç å±•ç¤ºå¦‚ä½•éƒ¨ç½² IMU ä¼ æ„Ÿå™¨ã€æ³¨å†Œç›‘å¬å™¨ï¼Œå¹¶å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®ï¼š</p>
<div class="highlight"><pre><span></span><code>def on_imu(event):
    acc = event.accelerometer
    gyro = event.gyroscope
    compass = event.compass
    print(f&quot;[IMU] åŠ é€Ÿåº¦: {acc} | è§’é€Ÿåº¦: {gyro} | ç½—ç›˜: {compass}&quot;)

# åˆ›å»ºä¼ æ„Ÿå™¨
bp = world.get_blueprint_library().find(&#39;sensor.other.imu&#39;)
transform = carla.Transform(carla.Location(x=0, y=0, z=1.0))
imu_sensor = world.spawn_actor(bp, transform, attach_to=vehicle)
imu_sensor.listen(on_imu)
</code></pre></div>
<hr />
<h2 id="5">5 æ‹“å±•ç”¨ä¾‹ä¸é›†æˆåº”ç”¨</h2>
<p>IMU å¸¸ä¸ GNSSã€ç›¸æœºã€é›·è¾¾ç­‰ä¼ æ„Ÿå™¨è”ç”¨ï¼Œå®ç°é«˜çº§çŠ¶æ€ä¼°è®¡ï¼š</p>
<p><strong>ä¸ GNSS èåˆï¼š</strong></p>
<div class="highlight"><pre><span></span><code>def on_gnss(gnss):
    print(f&quot;[GNSS] çº¬åº¦: {gnss.latitude}, ç»åº¦: {gnss.longitude}&quot;)

imu_sensor.listen(on_imu)
gnss_sensor.listen(on_gnss)
</code></pre></div>
<p><strong>ä¼°ç®—è½¦è¾†é€Ÿåº¦ï¼ˆç§¯åˆ†æ³•ï¼Œç®€åŒ–ç¤ºä¾‹ï¼‰ï¼š</strong></p>
<div class="highlight"><pre><span></span><code>velocity = carla.Vector3D()

def on_imu_integration(imu):
    global velocity
    dt = 0.05  # é»˜è®¤ 20Hz
    a = imu.accelerometer
    velocity.x += a.x * dt
    velocity.y += a.y * dt
    velocity.z += a.z * dt
    print(f&quot;ä¼°ç®—é€Ÿåº¦: {velocity}&quot;)
</code></pre></div>
<hr />
<h2 id="6_1">6 é™åˆ¶ä¸å¯¹æ¯”åˆ†æ</h2>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>CARLA IMU</th>
<th>çœŸå® IMUï¼ˆå¦‚ Xsensï¼‰</th>
</tr>
</thead>
<tbody>
<tr>
<td>æ›´æ–°é¢‘ç‡</td>
<td>é»˜è®¤ 20Hzï¼Œå¯è°ƒ</td>
<td>æœ€é«˜ &gt; 1000Hz</td>
</tr>
<tr>
<td>å™ªå£°å»ºæ¨¡</td>
<td>é»˜è®¤æ— å™ªå£°</td>
<td>å«åç½®ã€æ¼‚ç§»ç­‰éšæœºæ‰°åŠ¨</td>
</tr>
<tr>
<td>æ—¶é—´åŒæ­¥</td>
<td>è‡ªåŠ¨ä¸ä»¿çœŸå¯¹é½</td>
<td>éœ€ç¡¬ä»¶çº§æ—¶é—´æˆ³</td>
</tr>
<tr>
<td>æ•°æ®è¾“å‡º</td>
<td>æ—  CSV å¯¼å‡º</td>
<td>æ”¯æŒæ ‡å‡†æ ¼å¼</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="7_1">7 æ€»ç»“ä¸å»ºè®®</h2>
<ul>
<li><code>sensor.other.imu</code> æä¾›ç»“æ„æ¸…æ™°ã€æ˜“ç”¨çš„å§¿æ€/è¿åŠ¨çŠ¶æ€åé¦ˆèƒ½åŠ›ï¼›</li>
<li>å¯æ‹“å±•ä¸ºå¸¦å™ªæ¨¡å‹ã€åŠ æƒæ»¤æ³¢ã€æ•°æ®èåˆå¹³å°ï¼›</li>
<li>å»ºè®®ä¸ <code>sensor.other.gnss</code>ã€<code>sensor.camera.rgb</code> è”åˆä½¿ç”¨ï¼Œæ”¯æŒè½¨è¿¹åˆ†æã€ä¸‰ç»´é‡å»ºç­‰ç ”ç©¶ä»»åŠ¡ï¼›</li>
<li>åç»­å¯å¼•å…¥ IMU å™ªå£°æ¨¡æ‹Ÿæ¨¡å—ã€æ•°æ®å¯¼å‡ºåŠŸèƒ½ã€‚</li>
</ul>
<hr />
<h1 id="carla-sensorothergnss">ç¬¬å››ç« ï¼šCARLA å…¨çƒå¯¼èˆªå«æ˜Ÿç³»ç»Ÿä¼ æ„Ÿå™¨ï¼ˆsensor.other.gnssï¼‰</h1>
<hr />
<h2 id="1_3">1 æ¨¡å—æ¦‚è§ˆ</h2>
<p><img alt="flowchart_4.png" src="../../img/modules/flowchart_4.png" /></p>
<p><code>sensor.other.gnss</code> æ˜¯ CARLA ä¸­ç”¨äºè·å–åœ°ç†ä½ç½®ä¿¡æ¯çš„ä¼ æ„Ÿå™¨ï¼Œæ¨¡æ‹ŸçœŸå®ä¸–ç•Œä¸­çš„å…¨çƒå¯¼èˆªå«æ˜Ÿç³»ç»Ÿï¼ˆGNSSï¼‰è®¾å¤‡ï¼Œå¦‚ GPSã€åŒ—æ–—ç­‰ã€‚ä¼ æ„Ÿå™¨è¾“å‡ºåŒ…æ‹¬ï¼š</p>
<ul>
<li><strong>ç»åº¦ï¼ˆlongitudeï¼‰</strong>ï¼šå•ä½Â°ï¼ŒèŒƒå›´ $-180Â°, 180Â°$</li>
<li><strong>çº¬åº¦ï¼ˆlatitudeï¼‰</strong>ï¼šå•ä½Â°ï¼ŒèŒƒå›´ $-90Â°, 90Â°$</li>
<li><strong>æµ·æ‹”ï¼ˆaltitudeï¼‰</strong>ï¼šå•ä½ mï¼Œä»£è¡¨ç›¸å¯¹äºæµ·å¹³é¢çš„é«˜åº¦</li>
</ul>
<p>è¯¥ä¼ æ„Ÿå™¨å¯ç”¨äºåœºæ™¯å®šä½ã€è·¯å¾„é‡å»ºã€è½¨è¿¹åˆ†æç­‰ä»¿çœŸä»»åŠ¡ä¸­ï¼Œå¸¸ä¸ IMUã€åœ°å›¾åŒ¹é…æ¨¡å—è”åˆä½¿ç”¨ã€‚</p>
<hr />
<h2 id="2_3">2 å·¥ä½œæµç¨‹ä¸ä¼ è¾“æœºåˆ¶</h2>
<p>GNSS çš„æ•°æ®ä¼ è¾“æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li><strong>äº‹ä»¶ç”Ÿæˆ</strong>ï¼šæœåŠ¡ç«¯åœ¨å½“å‰ä»¿çœŸå¸§ä¸­ç”Ÿæˆåœ°ç†ä½ç½®ä¿¡æ¯</li>
<li><strong>æ•°æ®æ‰“åŒ…</strong>ï¼šé€šè¿‡ <code>GnssSerializer</code> å°† <code>GeoLocation</code> åºåˆ—åŒ–ä¸º MsgPack æ ¼å¼çš„ <code>RawData</code></li>
<li><strong>ç½‘ç»œä¼ è¾“</strong>ï¼šæ‰“åŒ…åçš„å­—èŠ‚æµé€šè¿‡ CARLA çš„ RPC ç³»ç»Ÿå‘é€ç»™å®¢æˆ·ç«¯</li>
<li><strong>æ•°æ®è¿˜åŸ</strong>ï¼šå®¢æˆ·ç«¯ä½¿ç”¨ <code>GnssMeasurement</code> ç±»è§£ç  <code>RawData</code>ï¼Œå¾—åˆ°ç»“æ„åŒ–æ•°æ®</li>
<li><strong>Python å±‚ç›‘å¬</strong>ï¼š<code>.listen()</code> æ¥å£æ³¨å†Œçš„å‡½æ•°åœ¨æ¯æ¬¡æ›´æ–°ä¸­è§¦å‘å›è°ƒ</li>
</ol>
<hr />
<h2 id="3_1">3 æ•°æ®ç»“æ„è§£æ</h2>
<p>å®šä¹‰ä½ç½®ï¼š<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/data/GnssMeasurement.h"><code>GnssMeasurement.h</code></a></p>
<div class="highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GnssMeasurement</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">SensorData</span><span class="w"> </span><span class="p">{</span>
<span class="k">public</span><span class="o">:</span>
<span class="w">  </span><span class="n">geom</span><span class="o">::</span><span class="n">GeoLocation</span><span class="w"> </span><span class="n">GetGeoLocation</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="nf">GetLongitude</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="nf">GetLatitude</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="nf">GetAltitude</span><span class="p">()</span><span class="w"> </span><span class="k">const</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>
<p>å…¶ä¸­ï¼š</p>
<ul>
<li><code>GeoLocation</code> ç»“æ„ä½“å°è£…äº† <code>{ longitude, latitude, altitude }</code></li>
<li>æ¯å¸§æ›´æ–°ä¸€æ¬¡ï¼Œæ•°æ®æ¥æºä¸ºæœåŠ¡ç«¯ç¯å¢ƒæ¨¡æ‹Ÿçš„è½¦è¾†çœŸå®ä½ç½®ä¿¡æ¯</li>
</ul>
<p>é»˜è®¤è¾“å‡ºå•ä½ä¸ºï¼š</p>
<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å•ä½</th>
</tr>
</thead>
<tbody>
<tr>
<td>Longitude</td>
<td>double</td>
<td>åº¦ï¼ˆÂ°ï¼‰</td>
</tr>
<tr>
<td>Latitude</td>
<td>double</td>
<td>åº¦ï¼ˆÂ°ï¼‰</td>
</tr>
<tr>
<td>Altitude</td>
<td>double</td>
<td>ç±³ï¼ˆmï¼‰</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="4_1">4 åºåˆ—åŒ–æœºåˆ¶åˆ†æ</h2>
<p>å®šä¹‰æ–‡ä»¶ï¼š
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/s11n/GnssSerializer.h"><code>GnssSerializer.h</code></a>
<a href="https://github.com/OpenHUTB/carla_cpp/blob/dev/LibCarla/source/carla/sensor/s11n/GnssSerializer.cpp"><code>GnssSerializer.cpp</code></a></p>
<div class="highlight"><pre><span></span><code><span class="c1">// å®¢æˆ·ç«¯è§£ç é€»è¾‘</span>
<span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="w"> </span><span class="n">GnssSerializer</span><span class="o">::</span><span class="n">Deserialize</span><span class="p">(</span><span class="n">RawData</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">SharedPtr</span><span class="o">&lt;</span><span class="n">SensorData</span><span class="o">&gt;</span><span class="p">(</span><span class="k">new</span><span class="w"> </span><span class="n">data</span><span class="o">::</span><span class="n">GnssMeasurement</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">move</span><span class="p">(</span><span class="n">data</span><span class="p">)));</span>
<span class="p">}</span>
</code></pre></div>
<p>åºåˆ—åŒ–ç»“æ„ä½“ä½¿ç”¨ <code>MSGPACK_DEFINE_ARRAY</code> è‡ªåŠ¨å®Œæˆï¼š</p>
<div class="highlight"><pre><span></span><code><span class="k">struct</span><span class="w"> </span><span class="nc">GeoLocation</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">latitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">longitude</span><span class="p">;</span>
<span class="w">  </span><span class="kt">double</span><span class="w"> </span><span class="n">altitude</span><span class="p">;</span>
<span class="w">  </span><span class="n">MSGPACK_DEFINE_ARRAY</span><span class="p">(</span><span class="n">latitude</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="p">,</span><span class="w"> </span><span class="n">altitude</span><span class="p">)</span>
<span class="p">};</span>
</code></pre></div>
<p>è¯¥æœºåˆ¶ä¿è¯ GNSS æ•°æ®ä½“ç§¯å°ã€è§£ç å¿«ï¼Œé€‚åˆé«˜é¢‘ä¼ è¾“ä¸è·¨è¯­è¨€å…¼å®¹ã€‚</p>
<hr />
<h2 id="5-python-api_1">5 Python API ä½¿ç”¨ç¤ºä¾‹</h2>
<div class="highlight"><pre><span></span><code><span class="c1"># å®šä¹‰å›è°ƒå‡½æ•°</span>
<span class="k">def</span> <span class="nf">on_gnss</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">latitude</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">longitude</span>
    <span class="n">alt</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">altitude</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[GNSS] çº¬åº¦: </span><span class="si">{</span><span class="n">lat</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, ç»åº¦: </span><span class="si">{</span><span class="n">lon</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">, æµ·æ‹”: </span><span class="si">{</span><span class="n">alt</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">m&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="highlight"><pre><span></span><code><span class="c1"># åˆ›å»ºå¹¶ç»‘å®šä¼ æ„Ÿå™¨</span>
<span class="n">bp</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">get_blueprint_library</span><span class="p">()</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;sensor.other.gnss&#39;</span><span class="p">)</span>
<span class="n">transform</span> <span class="o">=</span> <span class="n">carla</span><span class="o">.</span><span class="n">Transform</span><span class="p">(</span><span class="n">carla</span><span class="o">.</span><span class="n">Location</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="mf">1.6</span><span class="p">))</span>
<span class="n">gnss_sensor</span> <span class="o">=</span> <span class="n">world</span><span class="o">.</span><span class="n">spawn_actor</span><span class="p">(</span><span class="n">bp</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">attach_to</span><span class="o">=</span><span class="n">vehicle</span><span class="p">)</span>
<span class="n">gnss_sensor</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="n">on_gnss</span><span class="p">)</span>
</code></pre></div>
<p>å¯é€‰è“å›¾å‚æ•°ï¼ˆ<code>bp.set_attribute(...)</code>ï¼‰åŒ…æ‹¬ï¼š</p>
<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>æè¿°</th>
<th>é»˜è®¤å€¼</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>sensor_tick</code></td>
<td>ä¼ æ„Ÿå™¨æ›´æ–°æ—¶é—´ï¼ˆç§’ï¼‰</td>
<td><code>0.05</code></td>
</tr>
</tbody>
</table>
<hr />
<h2 id="6_2">6 åº”ç”¨æ‹“å±•ä¸ç»„åˆä½¿ç”¨</h2>
<p>GNSS ä¼ æ„Ÿå™¨å¸¸ç”¨äºä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li><strong>è·¯å¾„é‡å»º</strong>ï¼šè®°å½•è½¦è¾†è¿è¡Œè½¨è¿¹ç”¨äºå›æ”¾</li>
<li><strong>å®šä½ç²¾åº¦éªŒè¯</strong>ï¼šä¸åœ°å›¾åŒ¹é…ç®—æ³•ç»“åˆæµ‹è¯•é²æ£’æ€§</li>
<li><strong>IMU + GNSS èåˆ</strong>ï¼šå®ç°åŸºäºæ‰©å±•å¡å°”æ›¼æ»¤æ³¢ï¼ˆEKFï¼‰çš„å®šä½</li>
</ul>
<h3 id="gnss-imu">ç¤ºä¾‹ï¼šGNSS ä¸ IMU è”åˆä½¿ç”¨</h3>
<div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">on_fused_data</span><span class="p">(</span><span class="n">gnss</span><span class="p">,</span> <span class="n">imu</span><span class="p">):</span>
    <span class="n">location</span> <span class="o">=</span> <span class="p">(</span><span class="n">gnss</span><span class="o">.</span><span class="n">latitude</span><span class="p">,</span> <span class="n">gnss</span><span class="o">.</span><span class="n">longitude</span><span class="p">)</span>
    <span class="n">acceleration</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">accelerometer</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[FUSION] åæ ‡: </span><span class="si">{</span><span class="n">location</span><span class="si">}</span><span class="s2">, åŠ é€Ÿåº¦: </span><span class="si">{</span><span class="n">acceleration</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div>
<p>è¯¥æ¨¡å¼å¯ç”¨äºè½¨è¿¹é‡å»ºã€åœ°ç†å›´æ æ£€æµ‹ã€è‡ªåŠ¨é©¾é©¶è¡Œä¸ºæ§åˆ¶ç­‰ä»»åŠ¡ã€‚</p>
<hr />
<h2 id="7_2">7 æ€»ç»“ä¸å»ºè®®</h2>
<ul>
<li><code>sensor.other.gnss</code> æä¾›é«˜ç²¾åº¦åœ°ç†ä½ç½®ä¿¡æ¯ï¼Œæ˜¯è‡ªåŠ¨é©¾é©¶ä»¿çœŸç³»ç»Ÿä¸­çš„å…³é”®æ¨¡å—ï¼›</li>
<li>ä¸ IMUã€æ‘„åƒå¤´ã€åœ°å›¾ç­‰é…åˆå¯å®ç°é«˜çº§ SLAM ä¸å®šä½ç®—æ³•éªŒè¯ï¼›</li>
<li>è‹¥éœ€å®ç°æ›´çœŸå®çš„æ¨¡å‹ï¼Œå¯æ‹“å±•æ·»åŠ å™ªå£°æ¨¡å‹ã€åœ°å½¢é®æŒ¡ã€ä¿¡å·ä¸¢å¤±æ¨¡æ‹Ÿç­‰åŠŸèƒ½ã€‚</li>
</ul>
<hr />
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      <script src="../../js/umlconvert.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
