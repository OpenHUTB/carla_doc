<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>ğŸš€Gameæ¨¡å—æŠ€æœ¯æ–‡æ¡£ - äººè½¦æ¨¡æ‹Ÿå™¨</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\ud83d\ude80Game\u6a21\u5757\u6280\u672f\u6587\u6863";
        var mkdocs_page_input_path = "modules/Game.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> äººè½¦æ¨¡æ‹Ÿå™¨
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">é¦–é¡µ</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">äººè½¦æ¨¡æ‹Ÿå™¨</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">ğŸš€Gameæ¨¡å—æŠ€æœ¯æ–‡æ¡£</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/modules/Game.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="game">ğŸš€Gameæ¨¡å—æŠ€æœ¯æ–‡æ¡£</h1>
<hr />
<h2 id="_1">ç›®å½•</h2>
<ol>
<li><a href="#ğŸ“æ¨¡å—æ¦‚è¿°">æ¨¡å—æ¦‚è¿°</a>  </li>
<li><a href="#ğŸ“šæ ¸å¿ƒåŠŸèƒ½è¯¦è§£">æ ¸å¿ƒåŠŸèƒ½è¯¦è§£</a>  </li>
<li><a href="#ğŸ“‘æ¨¡å—é—´å…³ç³»">æ¨¡å—é—´å…³ç³»</a>  </li>
<li><a href="#ğŸ“œç±»ä¸æ–¹æ³•è¯¦è§£">ç±»ä¸æ–¹æ³•è¯¦è§£</a>  </li>
<li><a href="#ğŸ“æ¨¡å—è°ƒç”¨é€»è¾‘">æ¨¡å—è°ƒç”¨é€»è¾‘</a>  </li>
<li><a href="#â—æ³¨æ„äº‹é¡¹">æ³¨æ„äº‹é¡¹</a> </li>
</ol>
<hr />
<h2 id="_2">ğŸ“æ¨¡å—æ¦‚è¿°</h2>
<p><code>Game</code>æ¨¡å—æ˜¯ CARLA é¡¹ç›®åœ¨è™šå¹»å¼•æ“ï¼ˆUE4/UE5ï¼‰ä¸­çš„æ ¸å¿ƒé€»è¾‘æ¨¡å—ï¼Œè´Ÿè´£ç®¡ç†è‡ªåŠ¨é©¾é©¶ä»¿çœŸåœºæ™¯çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸã€‚å…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼š
- <strong>åœºæ™¯ç®¡ç†</strong>ï¼šåŠ è½½ OpenDRIVE åœ°å›¾ã€åŠ¨æ€è®¾ç½®å¤©æ°”åŠäº¤é€šè§„åˆ™ï¼›
- <strong>è§’è‰²æ§åˆ¶</strong>ï¼šç”Ÿæˆè½¦è¾†ã€è¡Œäººã€ä¼ æ„Ÿå™¨ç­‰å®ä½“ï¼Œå¹¶ç»‘å®šç‰©ç†è¡Œä¸ºï¼ˆå¦‚è½¦è¾†ç§»åŠ¨ç»„ä»¶ï¼‰ï¼›
- <strong>ä¼ æ„Ÿå™¨äº¤äº’</strong>ï¼šé€šè¿‡æ‘„åƒå¤´ã€é›·è¾¾ã€æ¿€å…‰é›·è¾¾ç­‰ä¼ æ„Ÿå™¨å®æ—¶é‡‡é›†æ•°æ®ï¼Œå¹¶æ”¯æŒå¼‚æ­¥ä¼ è¾“åˆ°æœåŠ¡ç«¯æˆ– ROS2ï¼›
- <strong>å½•åˆ¶ä¸å›æ”¾</strong>ï¼šè®°å½•è½¦è¾†ä½ç½®ã€ä¼ æ„Ÿå™¨æ•°æ®ï¼Œå¹¶æ”¯æŒæŒ‰å¸§å›æ”¾ï¼›
- <strong>ROS2 é›†æˆ</strong>ï¼šé€šè¿‡å¸§åŒæ­¥æœºåˆ¶ä¸ ROS2 é€šä¿¡ï¼Œå‘å¸ƒä¼ æ„Ÿå™¨æ¶ˆæ¯ï¼ˆéœ€å¯ç”¨<code>WITH_ROS2</code>å®ï¼‰ï¼›
- <strong>è¯­ä¹‰åˆ†å‰²</strong>ï¼šä¸ºç”Ÿæˆçš„è§’è‰²åˆ†é…è¯­ä¹‰æ ‡ç­¾ï¼ˆå¦‚<code>CustomDepthStencilValue</code>ï¼‰ï¼Œæ”¯æŒè‡ªåŠ¨é©¾é©¶ç®—æ³•è®­ç»ƒä¸å¯è§†åŒ–ã€‚</p>
<p>è¯¥æ¨¡å—é€šè¿‡ <code>CarlaGameModeBase</code>ã€<code>CarlaEpisode</code> ç­‰æ ¸å¿ƒç±»åè°ƒè™šå¹»å¼•æ“ä¸ CARLA æœåŠ¡ç«¯çš„äº¤äº’ï¼Œæ˜¯è¿æ¥æ¸¸æˆé€»è¾‘ä¸è‡ªåŠ¨é©¾é©¶ä»¿çœŸçš„å…³é”®æ¡¥æ¢ã€‚</p>
<hr />
<h2 id="_3">ğŸ“šæ ¸å¿ƒåŠŸèƒ½è¯¦è§£</h2>
<h3 id="21">2.1 åœºæ™¯ç®¡ç†</h3>
<h4 id="_4"><strong>åœ°å›¾åŠ è½½</strong></h4>
<ul>
<li><strong>OpenDRIVE è§£æ</strong>ï¼šé€šè¿‡ <code>carla::opendrive::OpenDriveParser</code> è§£æ <code>.xodr</code> æ–‡ä»¶ç”Ÿæˆé“è·¯ç½‘ç»œã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaEpisode::LoadMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MapName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">opendrive</span><span class="o">::</span><span class="n">OpenDriveParser</span><span class="w"> </span><span class="n">parser</span><span class="p">(</span><span class="n">MapName</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">road</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">GetRoads</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CreateRoadActor</span><span class="p">(</span><span class="n">road</span><span class="p">);</span><span class="w"> </span><span class="c1">// ç”Ÿæˆé“è·¯Actor</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
<li><strong>åŠ¨æ€å¤©æ°”è®¾ç½®</strong>ï¼šé€šè¿‡<code>carla::rpc::WeatherParameters</code>åŠ¨æ€è°ƒæ•´é›¾ã€é›¨ã€äº‘ç­‰å¤©æ°”å‚æ•°ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaEpisode::SetWeather</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FWeatherParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Weather</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">WeatherParameters</span><span class="w"> </span><span class="n">carlaWeather</span><span class="p">;</span>
<span class="w">  </span><span class="n">carlaWeather</span><span class="p">.</span><span class="n">cloudiness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Weather</span><span class="p">.</span><span class="n">Cloudiness</span><span class="p">;</span>
<span class="w">  </span><span class="n">carlaWeather</span><span class="p">.</span><span class="n">wetness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Weather</span><span class="p">.</span><span class="n">Wetness</span><span class="p">;</span>
<span class="w">  </span><span class="c1">// è®¾ç½®è™šå¹»å¼•æ“å¤©æ°”ç³»ç»Ÿ</span>
<span class="w">  </span><span class="n">World</span><span class="o">-&gt;</span><span class="n">SetWeather</span><span class="p">(</span><span class="n">carlaWeather</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_5"><strong>äº¤é€šè§„åˆ™åˆå§‹åŒ–</strong></h4>
<ul>
<li><strong>ä¿¡å·ç¯ç®¡ç†</strong>ï¼šåŠ è½½äº¤é€šä¿¡å·ç¯ã€é“è·¯æ ‡å¿—ç­‰å®ä½“ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaEpisode::InitializeTrafficLights</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">*</span><span class="w"> </span><span class="n">Light</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">TrafficLightList</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">Light</span><span class="o">-&gt;</span><span class="n">SetState</span><span class="p">(</span><span class="n">carla</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">TrafficLightState</span><span class="o">::</span><span class="n">Green</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆå§‹åŒ–ä¸ºç»¿ç¯</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="22">2.2 è§’è‰²æ§åˆ¶</h3>
<h4 id="_6"><strong>å®ä½“ç”Ÿæˆ</strong></h4>
<ul>
<li><strong>Actor ç”Ÿæˆé€»è¾‘</strong>ï¼šé€šè¿‡<code>CarlaGameModeBase</code>çš„<code>SpawnActor</code>æ–¹æ³•ç”Ÿæˆè½¦è¾†ã€è¡Œäººã€ä¼ æ„Ÿå™¨ã€‚
  <div class="highlight"><pre><span></span><code><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="nf">CarlaGameModeBase::SpawnActor</span><span class="p">(</span><span class="n">TSubclassOf</span><span class="o">&lt;</span><span class="n">AActor</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Class</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">return</span><span class="w"> </span><span class="n">GetWorld</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SpawnActor</span><span class="p">(</span><span class="n">Class</span><span class="p">,</span><span class="w"> </span><span class="o">&amp;</span><span class="n">Transform</span><span class="p">);</span><span class="w"> </span><span class="c1">// åœ¨æŒ‡å®šä½ç½®ç”ŸæˆActor</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_7"><strong>è¡Œä¸ºç®¡ç†</strong></h4>
<ul>
<li><strong>è½¦è¾†ç‰©ç†æ¨¡æ‹Ÿ</strong>ï¼šç»‘å®šè½¦è¾†ç§»åŠ¨ç»„ä»¶ï¼ˆ<code>UWheeledVehicleMovementComponent</code>ï¼‰å®ç°ç‰©ç†æ¨¡æ‹Ÿã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaVehicle::InitializePhysics</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">UWheeledVehicleMovementComponent</span><span class="o">*</span><span class="w"> </span><span class="n">MovementComponent</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">FindComponentByClass</span><span class="o">&lt;</span><span class="n">UWheeledVehicleMovementComponent</span><span class="o">&gt;</span><span class="p">();</span>
<span class="w">  </span><span class="n">MovementComponent</span><span class="o">-&gt;</span><span class="n">SetMaxSpeed</span><span class="p">(</span><span class="mf">100.0f</span><span class="p">);</span><span class="w"> </span><span class="c1">// è®¾ç½®æœ€å¤§é€Ÿåº¦</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="23">2.3 ä¼ æ„Ÿå™¨äº¤äº’</h3>
<h4 id="_8"><strong>æ•°æ®é‡‡é›†</strong></h4>
<ul>
<li><strong>æ‘„åƒå¤´ä¼ æ„Ÿå™¨</strong>ï¼šå®æ—¶é‡‡é›†å›¾åƒæ•°æ®ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaCamera::Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">bIsActive</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">RenderImage</span><span class="p">();</span><span class="w"> </span><span class="c1">// æ¸²æŸ“å½“å‰å¸§å›¾åƒ</span>
<span class="w">    </span><span class="n">SendDataToServer</span><span class="p">();</span><span class="w"> </span><span class="c1">// å‘é€æ•°æ®åˆ°æœåŠ¡ç«¯</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
<li><strong>æ¿€å…‰é›·è¾¾ä¼ æ„Ÿå™¨</strong>ï¼šé‡‡é›†ç‚¹äº‘æ•°æ®ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaLidar::UpdateLidarData</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">FVector</span><span class="o">&gt;</span><span class="w"> </span><span class="n">PointCloud</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">GetPointCloud</span><span class="p">();</span><span class="w"> </span><span class="c1">// è·å–ç‚¹äº‘æ•°æ®</span>
<span class="w">  </span><span class="n">SendPointCloud</span><span class="p">(</span><span class="n">PointCloud</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‘é€ç‚¹äº‘åˆ°æœåŠ¡ç«¯</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_9"><strong>æ•°æ®å¤„ç†</strong></h4>
<ul>
<li><strong>å¼‚æ­¥æ•°æ®ä¼ è¾“</strong>ï¼šé€šè¿‡<code>AsyncDataStreamImpl</code>å¼‚æ­¥ä¼ è¾“ä¼ æ„Ÿå™¨æ•°æ®åˆ°æœåŠ¡ç«¯ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">AsyncDataStreamImpl::SendSensorData</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;&amp;</span><span class="w"> </span><span class="n">Data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Async</span><span class="p">(</span><span class="n">EAsyncExecution</span><span class="o">::</span><span class="n">Thread</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="n">Data</span><span class="p">]()</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="c1">// å¤„ç†æ•°æ®å¹¶å‘é€åˆ°æœåŠ¡ç«¯</span>
<span class="w">    </span><span class="n">SendToServer</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span>
<span class="w">  </span><span class="p">});</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="24">2.4 å½•åˆ¶ä¸å›æ”¾</h3>
<h4 id="_10"><strong>å½•åˆ¶åŠŸèƒ½</strong></h4>
<ul>
<li><strong>å½•åˆ¶é€»è¾‘</strong>ï¼šé€šè¿‡<code>ACarlaRecorder::StartRecording()</code>è®°å½•è½¦è¾†ä½ç½®ã€ä¼ æ„Ÿå™¨æ•°æ®ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaRecorder::StartRecording</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">FileWriter</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="s">&quot;recording.log&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">FileWriter</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;Frame,VehiclePosition,X,Y,Z</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_11"><strong>å›æ”¾åŠŸèƒ½</strong></h4>
<ul>
<li><strong>å›æ”¾é€»è¾‘</strong>ï¼šé€šè¿‡<code>CarlaReplayer::PlayBack()</code>æŒ‰å¸§å›æ”¾å½•åˆ¶æ•°æ®ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaReplayer::PlayBack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">HasMoreFrames</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ReadNextFrame</span><span class="p">();</span><span class="w"> </span><span class="c1">// è¯»å–ä¸‹ä¸€å¸§æ•°æ®</span>
<span class="w">    </span><span class="n">ApplyFrameData</span><span class="p">();</span><span class="w"> </span><span class="c1">// åº”ç”¨åˆ°è½¦è¾†å’Œä¼ æ„Ÿå™¨</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="25-ros2">2.5 ROS2 é›†æˆ</h3>
<h4 id="_12"><strong>å¸§åŒæ­¥</strong></h4>
<ul>
<li><strong>å¸§å·åŒæ­¥</strong>ï¼šé€šè¿‡<code>FCarlaEngine::FrameCounter</code>åŒæ­¥ä»¿çœŸå¸§ä¸ ROS2 è¯é¢˜æ—¶é—´æˆ³ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">FCarlaEngine::OnTick</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">FrameCounter</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="cp">#if defined(WITH_ROS2)</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">ros2</span><span class="o">::</span><span class="n">ROS2</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetFrame</span><span class="p">(</span><span class="n">FrameCounter</span><span class="p">);</span>
<span class="w">  </span><span class="cp">#endif</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_13"><strong>æ¶ˆæ¯å‘å¸ƒ</strong></h4>
<ul>
<li><strong>ä¼ æ„Ÿå™¨æ•°æ®è½¬æ¢</strong>ï¼šå°†ä¼ æ„Ÿå™¨æ•°æ®è½¬æ¢ä¸º ROS2 æ¶ˆæ¯ï¼ˆå¦‚<code>sensor_msgs::Image</code>ï¼‰ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaCamera::PublishToROS2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">  </span><span class="n">ConvertToROSImage</span><span class="p">(</span><span class="n">ImageData</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// è½¬æ¢ä¸ºROS2å›¾åƒæ¶ˆæ¯</span>
<span class="w">  </span><span class="n">Publisher</span><span class="o">-&gt;</span><span class="n">Publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‘å¸ƒåˆ°ROS2è¯é¢˜</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="26">2.6 è¯­ä¹‰åˆ†å‰²</h3>
<h4 id="_14"><strong>æ ‡ç­¾ç³»ç»Ÿ</strong></h4>
<ul>
<li><strong>è¯­ä¹‰æ ‡ç­¾åˆ†é…</strong>ï¼šé€šè¿‡<code>UTaggerDelegate</code>ä¸ºç”Ÿæˆçš„è§’è‰²åˆ†é…è¯­ä¹‰æ ‡ç­¾ï¼ˆå¦‚<code>CustomDepthStencilValue</code>ï¼‰ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">UTaggerDelegate::OnActorSpawned</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">SetCustomDepthStencilValue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ†é…è¯­ä¹‰æ ‡ç­¾</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h4 id="_15"><strong>é¢œè‰²æ˜ å°„</strong></h4>
<ul>
<li><strong>HUD å¯è§†åŒ–</strong>ï¼šåœ¨<code>ACarlaHUD</code>ä¸­ç»˜åˆ¶è¯­ä¹‰åˆ†å‰²é¢œè‰²æ˜ å°„å›¾ã€‚
  <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaHUD::DrawSemanticSegmentation</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">SemanticActors</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">DrawColoredBox</span><span class="p">(</span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetActorLocation</span><span class="p">(),</span><span class="w"> </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">GetSemanticColor</span><span class="p">());</span><span class="w"> </span><span class="c1">// ç»˜åˆ¶è¯­ä¹‰é¢œè‰²æ¡†</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h2 id="_16">ğŸ“‘æ¨¡å—é—´å…³ç³»</h2>
<h3 id="31"><strong>3.1 è°ƒç”¨å…³ç³»å›¾</strong></h3>
<p align="center">
 <img src="https://raw.githubusercontent.com/Elotkowski/KD-LoRA/refs/heads/main/00.png?token=GHSAT0AAAAAADCITNBNRCKN5E4U2VJ3HKIQ2A3GUJQ"  style="max-width: 100%; height: auto;"/>
</p>

<h3 id="32"><strong>3.2 æ¨¡å—ä¾èµ–</strong></h3>
<p>ä»¥ä¸‹ä¸º <code>Game</code> æ¨¡å—ä¸å…¶ä»–æ¨¡å—çš„å®Œæ•´ä¾èµ–å…³ç³»ï¼ˆæ•°å­—è¡¨ç¤ºä¾èµ–å¼ºåº¦ï¼‰ï¼š</p>
<table>
<thead>
<tr>
<th>æ¨¡å—åç§°</th>
<th>ä¸ Game æ¨¡å—çš„å…³ç³»æ•°</th>
<th>ä¸»è¦åŠŸèƒ½è¯´æ˜</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>LibCarla</strong></td>
<td>51</td>
<td>æ ¸å¿ƒé€»è¾‘äº¤äº’ï¼ŒåŒ…å« RPCã€åœ°å›¾åŠ è½½ç­‰</td>
</tr>
<tr>
<td><strong>Recorder</strong></td>
<td>25</td>
<td>å½•åˆ¶ä¸å›æ”¾åŠŸèƒ½</td>
</tr>
<tr>
<td><strong>Settings</strong></td>
<td>9</td>
<td>é…ç½®åŠ è½½ä¸å‚æ•°ç®¡ç†</td>
</tr>
<tr>
<td><strong>Sensor</strong></td>
<td>6</td>
<td>ä¼ æ„Ÿå™¨æ•°æ®é‡‡é›†ä¸å¤„ç†</td>
</tr>
<tr>
<td><strong>Util</strong></td>
<td>6</td>
<td>å·¥å…·å‡½æ•°ï¼ˆå¼‚æ­¥ä¼ è¾“ã€æ•°æ®å¤„ç†ï¼‰</td>
</tr>
<tr>
<td><strong>Traffic</strong></td>
<td>5</td>
<td>äº¤é€šè§„åˆ™ä¸ä¿¡å·ç¯æ§åˆ¶</td>
</tr>
<tr>
<td><strong>Lights</strong></td>
<td>4</td>
<td>äº¤é€šä¿¡å·ç¯ç®¡ç†</td>
</tr>
<tr>
<td><strong>Actor</strong></td>
<td>4</td>
<td>è§’è‰²ç”Ÿæˆä¸äº¤äº’</td>
</tr>
<tr>
<td><strong>MapGen</strong></td>
<td>4</td>
<td>åœ°å›¾ç”Ÿæˆä¸ OpenDRIVE è§£æ</td>
</tr>
<tr>
<td><strong>Server</strong></td>
<td>3</td>
<td>æœåŠ¡ç«¯é€šä¿¡æ¥å£</td>
</tr>
<tr>
<td><strong>Vehicle</strong></td>
<td>3</td>
<td>è½¦è¾†ç‰©ç†æ¨¡æ‹Ÿä¸æ§åˆ¶</td>
</tr>
<tr>
<td><strong>Weather</strong></td>
<td>2</td>
<td>åŠ¨æ€å¤©æ°”å‚æ•°è®¾ç½®</td>
</tr>
<tr>
<td><strong>OpenDrive</strong></td>
<td>1</td>
<td>OpenDRIVE åœ°å›¾æ–‡ä»¶è§£æ</td>
</tr>
</tbody>
</table>
<p>è¯¦ç»†æ¨¡å—å…³ç³»å‚è€ƒï¼š<a href="https://openhutb.github.io/carla_cpp/dir_b708e75f0564cefaa95a07ef1c60fa1d.html"> :octocat: </a></p>
<h2 id="_17">ğŸ“œç±»ä¸æ–¹æ³•è¯¦è§£</h2>
<h3 id="41-acarlagamemodebase"><strong>4.1 ACarlaGameModeBase</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šæ¸¸æˆæ¨¡å¼åŸºç±»ï¼Œè´Ÿè´£åœºæ™¯åˆå§‹åŒ–å’Œå…¨å±€é€»è¾‘æ§åˆ¶ã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li>
<p><strong><code>InitGame(...)</code></strong><br />
    åˆå§‹åŒ–æ ¸å¿ƒæ¨¡å—ï¼ˆ<code>CarlaEpisode</code>ã€<code>CarlaRecorder</code>ï¼‰å¹¶åŠ è½½åœ°å›¾ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaGameModeBase::InitGame</span><span class="p">(...)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Episode</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">UCarlaEpisode</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Episode&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">Recorder</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">CreateDefaultSubobject</span><span class="o">&lt;</span><span class="n">ACarlaRecorder</span><span class="o">&gt;</span><span class="p">(</span><span class="s">&quot;Recorder&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">Episode</span><span class="o">-&gt;</span><span class="n">LoadMap</span><span class="p">(</span><span class="n">SelectedMap</span><span class="p">);</span><span class="w"> </span><span class="c1">// åŠ è½½æŒ‡å®šåœ°å›¾</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong><code>Tick(float DeltaTime)</code></strong><br />
    æ¯å¸§è°ƒç”¨ï¼Œæ›´æ–°åœºæ™¯çŠ¶æ€å’Œä¼ æ„Ÿå™¨æ•°æ®ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaGameModeBase::Tick</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Episode</span><span class="o">-&gt;</span><span class="n">Update</span><span class="p">();</span><span class="w"> </span><span class="c1">// æ›´æ–°è½¦è¾†/ä¼ æ„Ÿå™¨çŠ¶æ€</span>
<span class="w">  </span><span class="n">Recorder</span><span class="o">-&gt;</span><span class="n">CheckRecord</span><span class="p">();</span><span class="w"> </span><span class="c1">// æ£€æŸ¥æ˜¯å¦éœ€è¦å½•åˆ¶</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="42-carlaepisode"><strong>4.2 CarlaEpisode</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šç®¡ç†åœºæ™¯ç”Ÿå‘½å‘¨æœŸï¼ˆåœ°å›¾ã€å¤©æ°”ã€äº¤é€šè§„åˆ™ï¼‰ã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li>
<p><strong><code>LoadMap(const FString&amp; MapName)</code></strong><br />
    è§£æ OpenDRIVE æ–‡ä»¶å¹¶ç”Ÿæˆé“è·¯ç½‘ç»œã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaEpisode::LoadMap</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FString</span><span class="o">&amp;</span><span class="w"> </span><span class="n">MapName</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">opendrive</span><span class="o">::</span><span class="n">OpenDriveParser</span><span class="w"> </span><span class="n">parser</span><span class="p">(</span><span class="n">MapName</span><span class="p">);</span>
<span class="w">  </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="k">auto</span><span class="o">&amp;</span><span class="w"> </span><span class="n">road</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="n">parser</span><span class="p">.</span><span class="n">GetRoads</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">CreateRoadActor</span><span class="p">(</span><span class="n">road</span><span class="p">);</span><span class="w"> </span><span class="c1">// ç”Ÿæˆé“è·¯Actor</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong><code>SetWeather(const FWeatherParameters&amp; Weather)</code></strong><br />
    åº”ç”¨åŠ¨æ€å¤©æ°”å‚æ•°ï¼ˆäº‘é‡ã€æ¹¿åº¦ç­‰ï¼‰ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaEpisode::SetWeather</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">FWeatherParameters</span><span class="o">&amp;</span><span class="w"> </span><span class="n">Weather</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">rpc</span><span class="o">::</span><span class="n">WeatherParameters</span><span class="w"> </span><span class="n">carlaWeather</span><span class="p">;</span>
<span class="w">  </span><span class="n">carlaWeather</span><span class="p">.</span><span class="n">cloudiness</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Weather</span><span class="p">.</span><span class="n">Cloudiness</span><span class="p">;</span>
<span class="w">  </span><span class="n">World</span><span class="o">-&gt;</span><span class="n">SetWeather</span><span class="p">(</span><span class="n">carlaWeather</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="43-acarlarecorder"><strong>4.3 ACarlaRecorder</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè®°å½•å’Œå›æ”¾æ¨¡æ‹Ÿè¿‡ç¨‹æ•°æ®ã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li>
<p><strong><code>StartRecording()</code></strong><br />
    å¼€å§‹è®°å½•è½¦è¾†ä½ç½®ã€ä¼ æ„Ÿå™¨æ•°æ®åˆ°æ–‡ä»¶ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaRecorder::StartRecording</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">FileWriter</span><span class="p">.</span><span class="n">Open</span><span class="p">(</span><span class="s">&quot;recording.log&quot;</span><span class="p">);</span>
<span class="w">  </span><span class="n">FileWriter</span><span class="p">.</span><span class="n">Write</span><span class="p">(</span><span class="s">&quot;Frame,VehiclePosition,X,Y,Z</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong><code>PlayBack()</code></strong><br />
    æŒ‰å¸§å›æ”¾å½•åˆ¶æ•°æ®ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">ACarlaRecorder::PlayBack</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">HasMoreFrames</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">    </span><span class="n">ReadNextFrame</span><span class="p">();</span><span class="w"> </span><span class="c1">// è¯»å–ä¸‹ä¸€å¸§æ•°æ®</span>
<span class="w">    </span><span class="n">ApplyFrameData</span><span class="p">();</span><span class="w"> </span><span class="c1">// åº”ç”¨åˆ°è½¦è¾†å’Œä¼ æ„Ÿå™¨</span>
<span class="w">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<h3 id="44-utaggerdelegate"><strong>4.4 UTaggerDelegate</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šè¯­ä¹‰åˆ†å‰²æ ‡ç­¾ç®¡ç†å™¨ï¼Œä¸ºè§’è‰²åˆ†é…è¯­ä¹‰IDã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li><strong><code>OnActorSpawned(AActor* Actor)</code></strong><br />
    ä¸ºç”Ÿæˆçš„è§’è‰²åˆ†é… <code>CustomDepthStencilValue</code>ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">UTaggerDelegate::OnActorSpawned</span><span class="p">(</span><span class="n">AActor</span><span class="o">*</span><span class="w"> </span><span class="n">Actor</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">Actor</span><span class="o">-&gt;</span><span class="n">SetCustomDepthStencilValue</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span><span class="w"> </span><span class="c1">// åˆ†é…è¯­ä¹‰æ ‡ç­¾</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="45-fcarlaengine"><strong>4.5 FCarlaEngine</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šå¼•æ“æ ¸å¿ƒé€»è¾‘ï¼Œæä¾›å¸§è®¡æ•°å™¨å’ŒROS2é›†æˆã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li><strong><code>OnTick()</code></strong><br />
    é€’å¢å¸§è®¡æ•°å™¨å¹¶åŒæ­¥åˆ°ROS2ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">FCarlaEngine::OnTick</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">FrameCounter</span><span class="w"> </span><span class="o">+=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">  </span><span class="cp">#if defined(WITH_ROS2)</span>
<span class="w">  </span><span class="n">carla</span><span class="o">::</span><span class="n">ros2</span><span class="o">::</span><span class="n">ROS2</span><span class="o">::</span><span class="n">GetInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">SetFrame</span><span class="p">(</span><span class="n">FrameCounter</span><span class="p">);</span>
<span class="w">  </span><span class="cp">#endif</span>
<span class="p">}</span>
</code></pre></div></li>
</ul>
<h3 id="46-carlasensor"><strong>4.6 CarlaSensor</strong></h3>
<ul>
<li><strong>åŠŸèƒ½</strong>ï¼šä¼ æ„Ÿå™¨åŸºç±»ï¼Œå®šä¹‰æ•°æ®é‡‡é›†ä¸ä¼ è¾“æ¥å£ã€‚</li>
<li><strong>å…³é”®æ–¹æ³•</strong>ï¼š</li>
<li>
<p><strong><code>Update(float DeltaTime)</code></strong><br />
    é‡‡é›†ä¼ æ„Ÿå™¨æ•°æ®å¹¶å¼‚æ­¥å‘é€åˆ°æœåŠ¡ç«¯ã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaSensor::Update</span><span class="p">(</span><span class="kt">float</span><span class="w"> </span><span class="n">DeltaTime</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">TArray</span><span class="o">&lt;</span><span class="n">uint8</span><span class="o">&gt;</span><span class="w"> </span><span class="n">Data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">Capture</span><span class="p">();</span><span class="w"> </span><span class="c1">// é‡‡é›†æ•°æ®</span>
<span class="w">  </span><span class="n">AsyncDataStreamImpl</span><span class="o">::</span><span class="n">Send</span><span class="p">(</span><span class="n">Data</span><span class="p">);</span><span class="w"> </span><span class="c1">// å¼‚æ­¥ä¼ è¾“</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
<li>
<p><strong><code>PublishToROS2()</code></strong><br />
    å°†æ•°æ®è½¬æ¢ä¸ºROS2æ¶ˆæ¯å¹¶å‘å¸ƒã€‚
    <div class="highlight"><pre><span></span><code><span class="kt">void</span><span class="w"> </span><span class="nf">CarlaSensor::PublishToROS2</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">sensor_msgs</span><span class="o">::</span><span class="n">Image</span><span class="w"> </span><span class="n">msg</span><span class="p">;</span>
<span class="w">  </span><span class="n">ConvertToROSImage</span><span class="p">(</span><span class="n">Data</span><span class="p">,</span><span class="w"> </span><span class="n">msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// è½¬æ¢ä¸ºROS2å›¾åƒæ¶ˆæ¯</span>
<span class="w">  </span><span class="n">Publisher</span><span class="o">-&gt;</span><span class="n">Publish</span><span class="p">(</span><span class="n">msg</span><span class="p">);</span><span class="w"> </span><span class="c1">// å‘å¸ƒåˆ°ROS2è¯é¢˜</span>
<span class="p">}</span>
</code></pre></div></p>
</li>
</ul>
<hr />
<h2 id="_18">ğŸ“æ¨¡å—è°ƒç”¨é€»è¾‘</h2>
<p>æœ¬æ¨¡å—çš„ä»£ç ç»“æ„å¦‚ä¸‹ï¼š</p>
<pre><code>Game
â”œâ”€â”€ LibCarla (51)                # æ ¸å¿ƒäº¤äº’
â”‚   â”œâ”€â”€ LoadMap()                # åœ°å›¾åŠ è½½
â”‚   â”œâ”€â”€ SetWeather()             # å¤©æ°”è®¾ç½®
â”‚   â””â”€â”€ VehicleControl()         # è½¦è¾†æ§åˆ¶
â”œâ”€â”€ Recorder (25)                # å½•åˆ¶ä¸å›æ”¾
â”‚   â”œâ”€â”€ StartRecording()         # å¼€å§‹å½•åˆ¶
â”‚   â””â”€â”€ PlayBack()               # å›æ”¾
â”œâ”€â”€ Sensor (6)                   # ä¼ æ„Ÿå™¨
â”‚   â”œâ”€â”€ CaptureData()            # æ•°æ®é‡‡é›†
â”‚   â””â”€â”€ SendToServer()           # æ•°æ®ä¼ è¾“
â”œâ”€â”€ Settings (9)                 # é…ç½®ç®¡ç†
â”œâ”€â”€ Traffic (5)                  # äº¤é€šè§„åˆ™
â”‚   â”œâ”€â”€ Lights (4)               # ä¿¡å·ç¯æ§åˆ¶
â”œâ”€â”€ Util (6)                     # å·¥å…·å‡½æ•°
â””â”€â”€ Weather (2)                  # åŠ¨æ€å¤©æ°”
</code></pre>
<h2 id="_19">â—æ³¨æ„äº‹é¡¹</h2>
<h3 id="61"><strong>6.1 æ€§èƒ½ä¼˜åŒ–</strong></h3>
<ul>
<li><strong>é«˜é¢‘è°ƒç”¨å‡½æ•°</strong>ï¼š  </li>
<li><code>FCarlaEngine::OnTick()</code> å’Œ <code>CarlaGameModeBase::Tick()</code> éœ€é¿å…é˜»å¡æ“ä½œï¼Œå»ºè®®å°†ä¼ æ„Ÿå™¨æ•°æ®å¤„ç†ç§»è‡³å¤šçº¿ç¨‹ï¼ˆå¦‚ <code>AsyncDataStreamImpl</code>ï¼‰ã€‚  </li>
<li>
<p>é«˜æƒé‡æ¨¡å—ï¼ˆå¦‚ <code>LibCarla</code>ã€<code>Recorder</code>ï¼‰çš„è°ƒç”¨éœ€æ§åˆ¶é¢‘ç‡ï¼Œé˜²æ­¢å¸§ç‡ä¸‹é™ã€‚</p>
</li>
<li>
<p><strong>å†…å­˜ç®¡ç†</strong>ï¼š  </p>
</li>
<li>å¤ç”¨ <code>HUDString</code> å’Œ <code>HUDLine</code> ç»“æ„ä½“å®ä¾‹ï¼Œå‡å°‘åŠ¨æ€å†…å­˜åˆ†é…ã€‚  </li>
<li>é¿å…é¢‘ç¹åˆ›å»º/é”€æ¯ <code>AsyncDataStreamImpl</code> å®ä¾‹ï¼Œå»ºè®®å¤ç”¨è¿æ¥ã€‚</li>
</ul>
<hr />
<h3 id="62"><strong>6.2 èµ„æºé‡Šæ”¾</strong></h3>
<ul>
<li><strong>æ–‡ä»¶å¥æŸ„</strong>ï¼š  </li>
<li><code>CarlaRecorder::StopRecording()</code> å¿…é¡»æ‰‹åŠ¨è°ƒç”¨ <code>FileWriter.Close()</code> é‡Šæ”¾æ–‡ä»¶èµ„æºã€‚  </li>
<li>
<p>å›æ”¾ç»“æŸåéœ€æ¸…ç† <code>CarlaReplayer</code> ç¼“å­˜çš„å¸§æ•°æ®ã€‚</p>
</li>
<li>
<p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š  </p>
</li>
<li>å¤šçº¿ç¨‹è®¿é—® <code>FrameCounter</code> æ—¶éœ€åŠ é”ï¼ˆ<code>std::mutex</code>ï¼‰ï¼Œé˜²æ­¢ç«æ€æ¡ä»¶ã€‚  </li>
<li><code>AsyncDataStreamImpl::Send()</code> éœ€ç¡®ä¿çº¿ç¨‹é—´æ•°æ®åŒæ­¥ã€‚</li>
</ul>
<hr />
<h3 id="63"><strong>6.3 ç‰ˆæœ¬å…¼å®¹æ€§</strong></h3>
<ul>
<li><strong>ROS2 å®å¯ç”¨</strong>ï¼š  </li>
<li>ä½¿ç”¨ ROS2 åŠŸèƒ½å‰éœ€ç¡®è®¤ <code>WITH_ROS2</code> å®å·²å¯ç”¨ï¼Œå¦åˆ™ç¼–è¯‘ä¼šæŠ¥é”™ã€‚  </li>
<li>
<p>ä¾èµ–çš„ ROS2 æ¶ˆæ¯ç±»å‹éœ€ä¸ CARLA æœåŠ¡ç«¯ç‰ˆæœ¬åŒ¹é…ã€‚</p>
</li>
<li>
<p><strong>UE4/UE5 å·®å¼‚</strong>ï¼š  </p>
</li>
<li><code>UWorld</code> å’Œ <code>AActor</code> åœ¨ UE5 ä¸­çš„æ¥å£å¯èƒ½å˜åŒ–ï¼Œéœ€é€‚é… <code>CarlaEpisode</code> å’Œ <code>Sensor</code> çš„è°ƒç”¨é€»è¾‘ã€‚  </li>
<li><code>AsyncDataStreamImpl</code> åœ¨ UE5 ä¸­éœ€æ›¿æ¢ä¸º <code>FAsyncTask</code> å®ç°ã€‚</li>
</ul>
<hr />
<h3 id="64"><strong>6.4 å¸¸è§é—®é¢˜</strong></h3>
<ul>
<li><strong>ä¼ æ„Ÿå™¨æœªå“åº”</strong>ï¼š  </li>
<li>æ£€æŸ¥ <code>CarlaEpisode</code> æ˜¯å¦åˆå§‹åŒ–æˆåŠŸã€‚  </li>
<li>
<p>ç¡®è®¤ <code>CarlaGameInstance</code> å·²ç»‘å®šåˆ° <code>PlayerVehicle</code> å¹¶æ¿€æ´»ä¼ æ„Ÿå™¨ã€‚</p>
</li>
<li>
<p><strong>è¯­ä¹‰åˆ†å‰²å¤±è´¥</strong>ï¼š  </p>
</li>
<li>ç¡®ä¿ <code>UTaggerDelegate::SetSemanticSegmentationEnabled(true)</code> å·²è°ƒç”¨ã€‚  </li>
<li>
<p>éªŒè¯ <code>CustomDepthStencilValue</code> æ˜¯å¦åœ¨æ¸²æŸ“ç®¡çº¿ä¸­æ­£ç¡®é…ç½®ã€‚</p>
</li>
<li>
<p><strong>å½•åˆ¶æ–‡ä»¶æŸå</strong>ï¼š  </p>
</li>
<li>å›æ”¾å‰æ£€æŸ¥ <code>recording.log</code> æ–‡ä»¶æ ¼å¼æ˜¯å¦å®Œæ•´ã€‚  </li>
<li>ç¡®ä¿å½•åˆ¶æ—¶ <code>CarlaRecorder::StartRecording()</code> å·²æ­£ç¡®è°ƒç”¨ã€‚</li>
</ul>
<hr />
<h3 id="65"><strong>6.5 å¼€å‘å»ºè®®</strong></h3>
<ul>
<li><strong>æ¨¡å—ä¾èµ–æ§åˆ¶</strong>ï¼š  </li>
<li>é¿å…ç›´æ¥ä¾èµ–é«˜æƒé‡æ¨¡å—ï¼ˆå¦‚ <code>LibCarla</code>ï¼‰ï¼Œä¼˜å…ˆé€šè¿‡æ¥å£æŠ½è±¡è§£è€¦ã€‚  </li>
<li>
<p>ä½¿ç”¨ <code>Settings</code> æ¨¡å—åŠ¨æ€é…ç½®æ¨¡å—å¯ç”¨çŠ¶æ€ï¼Œæå‡çµæ´»æ€§ã€‚</p>
</li>
<li>
<p><strong>è°ƒè¯•å·¥å…·</strong>ï¼š  </p>
</li>
<li>å¯ç”¨ <code>CarlaHUD</code> çš„è°ƒè¯•æ¨¡å¼ï¼Œå®æ—¶æ˜¾ç¤ºå¸§ç‡ã€å†…å­˜å ç”¨ç­‰å…³é”®æŒ‡æ ‡ã€‚  </li>
<li>åˆ©ç”¨ <code>AsyncDataStreamImpl</code> çš„æ—¥å¿—åŠŸèƒ½è¿½è¸ªä¼ æ„Ÿå™¨æ•°æ®ä¼ è¾“å¼‚å¸¸ã€‚</li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      <script src="../../js/umlconvert.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
