<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Client - 人车模拟器</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Client";
        var mkdocs_page_input_path = "modules/client.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> 人车模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">首页</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">人车模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Client</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/modules/client.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="_1">概述</h2>
<p>CARLA 是一个开源的自动驾驶模拟平台，提供了丰富的 API 以支持仿真环境的控制、车辆的管理以及自动驾驶算法的验证。客户端部分的 API 主要通过 <code>Client</code> 类与模拟器进行交互，执行仿真控制、传感器管理、交通流管理等功能。该文档主要介绍 CARLA 客户端相关类的功能和使用方式。</p>
<h2 id="_2">主要类与功能</h2>
<h3 id="1-client">1. <strong>Client 类</strong></h3>
<p><code>Client</code> 类是与 CARLA 模拟器交互的核心类，提供了连接仿真器、加载世界、设置物理参数、控制传感器等功能。</p>
<h4 id="_3">构造函数</h4>
<ul>
<li><code>Client(const std::string &amp;host, uint16_t port, size_t worker_threads = 0u)</code></li>
<li>构建一个与 CARLA 仿真器的客户端连接。</li>
<li><code>host</code>：模拟器所在主机的 IP 地址。</li>
<li><code>port</code>：与模拟器的连接端口。</li>
<li><code>worker_threads</code>：使用的异步工作线程数，默认为 0（使用所有可用线程）。</li>
</ul>
<h4 id="_4">核心方法</h4>
<ul>
<li>
<p><code>std::string GetClientVersion() const</code></p>
</li>
<li>
<p>获取当前客户端的版本。</p>
</li>
<li>
<p><code>std::string GetServerVersion() const</code></p>
</li>
<li>
<p>获取当前连接的模拟器的版本。</p>
</li>
<li>
<p><code>std::vector&lt;std::string&gt; GetAvailableMaps() const</code></p>
</li>
<li>
<p>获取所有可用的地图名称。</p>
</li>
<li>
<p><code>World LoadWorld(std::string map_name, bool reset_settings = true, rpc::MapLayer map_layers = rpc::MapLayer::All) const</code></p>
</li>
<li>
<p>加载指定的仿真地图。</p>
</li>
<li>
<p><code>World ReloadWorld(bool reset_settings = true) const</code></p>
</li>
<li>
<p>重新加载当前仿真世界。</p>
</li>
<li>
<p><code>void SetTimeout(time_duration timeout)</code></p>
</li>
<li>
<p>设置与模拟器的网络超时时间。</p>
</li>
<li>
<p><code>TrafficManager GetInstanceTM(uint16_t port = TM_DEFAULT_PORT) const</code></p>
</li>
<li>
<p>获取当前模拟器中的交通管理实例（TrafficManager）。</p>
</li>
<li>
<p><code>void StartRecorder(std::string name, bool additional_data = false)</code></p>
</li>
<li>
<p>启动仿真数据记录器。</p>
</li>
<li>
<p><code>void StopRecorder()</code></p>
</li>
<li>
<p>停止仿真数据记录器。</p>
</li>
<li>
<p><code>World GenerateOpenDriveWorld(std::string opendrive, const rpc::OpendriveGenerationParameters &amp;params, bool reset_settings = true) const</code></p>
</li>
<li>使用 OpenDrive 文件生成仿真世界。</li>
</ul>
<h3 id="2-actor">2. <code>Actor</code> 类</h3>
<p><code>Actor</code> 类代表仿真中的任何实体（例如：车辆、行人等）。通过该类，用户可以控制行为体的位置、速度、碰撞、物理状态等。</p>
<h4 id="_5">核心方法</h4>
<ul>
<li>
<p><code>geom::Location GetLocation() const</code></p>
</li>
<li>
<p>获取行为体的当前位置。</p>
</li>
<li>
<p><code>geom::Transform GetTransform() const</code></p>
</li>
<li>
<p>获取行为体的变换（位置与方向）。</p>
</li>
<li>
<p><code>void SetLocation(const geom::Location&amp; location)</code></p>
</li>
<li>
<p>设置行为体的位置。</p>
</li>
<li>
<p><code>void SetTransform(const geom::Transform&amp; transform)</code></p>
</li>
<li>
<p>设置行为体的变换（位置与方向）。</p>
</li>
<li>
<p><code>void AddImpulse(const geom::Vector3D&amp; impulse)</code></p>
</li>
<li>
<p>向行为体添加冲量。</p>
</li>
<li>
<p><code>void AddForce(const geom::Vector3D&amp; force)</code></p>
</li>
<li>
<p>向行为体施加力。</p>
</li>
<li>
<p><code>void SetSimulatePhysics(bool enabled = true)</code></p>
</li>
<li>
<p>启用或禁用行为体的物理模拟。</p>
</li>
<li>
<p><code>bool Destroy()</code></p>
</li>
<li>销毁行为体。</li>
</ul>
<h3 id="3-clientsidesensor">3. <code>ClientSideSensor</code> 类</h3>
<p><code>ClientSideSensor</code> 类继承自 <code>Sensor</code> 类，代表 CARLA 中的客户端传感器（如摄像头、激光雷达等）。</p>
<h4 id="_6">核心方法</h4>
<ul>
<li>
<p><code>void Enable()</code></p>
</li>
<li>
<p>启用传感器。</p>
</li>
<li>
<p><code>void Disable()</code></p>
</li>
<li>
<p>禁用传感器。</p>
</li>
<li>
<p><code>bool IsEnabled() const</code></p>
</li>
<li>检查传感器是否启用。</li>
</ul>
<h3 id="4-trafficmanager">4. 交通管理器（<code>TrafficManager</code>）</h3>
<p><code>TrafficManager</code> 类用于管理仿真中的交通流，控制交通行为，包括交通灯的状态、车辆的行驶路线、交通规则等。</p>
<h4 id="_7">核心方法</h4>
<ul>
<li>
<p><code>void SetGlobalDistanceToLeadingVehicle(float distance)</code></p>
</li>
<li>
<p>设置车辆与前车的最小安全距离。</p>
</li>
<li>
<p><code>void SetVehicleDistanceToLeadingVehicle(float distance)</code></p>
</li>
<li>
<p>设置单个车辆与前车的最小安全距离。</p>
</li>
<li>
<p><code>void SetSynchronousMode(bool enabled)</code></p>
</li>
<li>启用或禁用同步模式，在同步模式下仿真步进是由用户控制的。</li>
</ul>
<h3 id="5-blueprintlibrary-actorblueprint">5. <code>BlueprintLibrary</code> 与 <code>ActorBlueprint</code> 类</h3>
<p>在 CARLA 客户端中，<code>BlueprintLibrary</code> 类用于提供创建行为体（Actor）的模板集合，而 <code>ActorBlueprint</code> 则描述具体实体的构造配置参数。</p>
<h4 id="_8">主要功能</h4>
<ul>
<li>
<p><code>BlueprintLibrary</code></p>
</li>
<li>
<p>获取可创建的实体蓝图列表（如车辆、传感器等）</p>
</li>
<li>
<p>支持通过关键词过滤蓝图</p>
</li>
<li>
<p><code>ActorBlueprint</code></p>
</li>
<li>表示单个实体的构造参数（如车辆类型、颜色，传感器分辨率等）</li>
<li>可设置和查询各类属性值</li>
</ul>
<h4 id="_9">示例</h4>
<div class="highlight"><pre><span></span><code>auto blueprint_library = world.GetBlueprintLibrary();

// 选择一辆特斯拉车型的 blueprint
auto vehicle_blueprint = (*blueprint_library)-&gt;Find(&quot;vehicle.tesla.model3&quot;);

// 设置车辆颜色
vehicle_blueprint-&gt;SetAttribute(&quot;color&quot;, &quot;255,0,0&quot;);

// 从地图上获取一个出生点
auto spawn_points = world.GetMap()-&gt;GetRecommendedSpawnPoints();
auto transform = spawn_points[0];

// 生成车辆 Actor
auto vehicle_actor = world.SpawnActor(*vehicle_blueprint, transform);
</code></pre></div>
<h3 id="6-sensor">6. <code>Sensor</code> 类与传感器使用（以摄像头为例）</h3>
<p>CARLA 支持多种传感器类型，例如摄像头、激光雷达、碰撞传感器等，传感器均继承自 <code>ClientSideSensor</code> 类。</p>
<h4 id="_10">创建与附加传感器的步骤</h4>
<ul>
<li>
<p>从 BlueprintLibrary 获取传感器蓝图</p>
</li>
<li>
<p>设置传感器参数（如图像分辨率、视场角等）</p>
</li>
<li>
<p>附加到目标 Actor（如车辆）</p>
</li>
<li>
<p>注册数据回调处理函数</p>
</li>
</ul>
<h3 id="_11">示例（以摄像头为例）</h3>
<div class="highlight"><pre><span></span><code>auto camera_bp = blueprint_library-&gt;Find(&quot;sensor.camera.rgb&quot;);
camera_bp-&gt;SetAttribute(&quot;image_size_x&quot;, &quot;800&quot;);
camera_bp-&gt;SetAttribute(&quot;image_size_y&quot;, &quot;600&quot;);
camera_bp-&gt;SetAttribute(&quot;fov&quot;, &quot;90&quot;);

// 定义相对于车辆的位置（车顶前部）
Transform camera_transform(Location(1.5f, 0.0f, 2.4f));

// 创建摄像头并附加到车辆
auto camera = world.SpawnActor(*camera_bp, camera_transform, vehicle_actor);

// 注册数据处理回调
std::static_pointer_cast&lt;ClientSideSensor&gt;(camera)-&gt;Listen([](auto data) {
    auto image = std::static_pointer_cast&lt;sensor::data::Image&gt;(data);
    image-&gt;SaveToDisk(&quot;output/%06d.png&quot;, image-&gt;GetFrame());
});
</code></pre></div>
<h3 id="7-world">7. <code>World</code> 类</h3>
<p>World 类表示一个仿真世界实例，它封装了场景中的地图、实体、天气、环境参数等。通过 <code>Client::LoadWorld()</code> 可获得 <code>World</code> 对象。</p>
<h4 id="_12">常用方法</h4>
<ul>
<li>
<p><code>GetActors()</code>：获取当前世界中所有实体</p>
</li>
<li>
<p><code>GetBlueprintLibrary()</code>：获取实体蓝图列表</p>
</li>
<li>
<p><code>SpawnActor()</code>：创建新实体</p>
</li>
<li>
<p><code>Tick()</code>：推进世界一帧（同步模式）</p>
</li>
<li>
<p><code>SetWeather()</code>：设置天气（如雨、雾、阳光）</p>
</li>
<li>
<p><code>GetMap()</code>：获取当前地图信息</p>
</li>
</ul>
<h4 id="_13">示例（以设置天气为例）</h4>
<div class="highlight"><pre><span></span><code>carla::rpc::WeatherParameters weather;
weather.cloudiness = 80.0f;
weather.precipitation = 30.0f;
weather.sun_altitude_angle = 45.0f;
world.SetWeather(weather);
</code></pre></div>
<hr />
<h2 id="_14">类之间的调用关系</h2>
<h3 id="carla">以下是 CARLA 客户端部分类之间的调用关系图，展示了各个类如何交互以及它们之间的依赖关系。</h3>
<p><img alt="类关系" src="https://github.com/LangJing23/nuanxin_volunteer/blob/master/lei.png" /></p>
<h5 id="_15">调用关系说明</h5>
<p>Client 类与其他类的交互：</p>
<blockquote>
<p>Client 类是与模拟器交互的主要接口，它通过方法如 LoadWorld()、GetAvailableMaps()、StartRecorder() 等来控制仿真世界。</p>
<p>Client 类使用 World 对象来表示仿真世界并操作其中的行为体（Actor 类）。</p>
<p>Actor 类与 Client 类的关系：</p>
<p>Actor 类表示仿真中的个体实体（如车辆、行人等），Client 类通过 Actor 对象控制仿真中的行为体（例如获取位置、速度，设置物理属性等）。</p>
<p>Actor 类也与传感器和交通管理相关联，可以通过 ClientSideSensor 和 TrafficManager 与交通流和传感器交互。</p>
<p>TrafficManager 类与 Client 类的关系：</p>
<p>TrafficManager 管理仿真中的交通流，Client 类通过 TrafficManager 提供的接口（如 SetSynchronousMode()）来控制仿真中的交通规则、车辆行为等。</p>
</blockquote>
<p>ClientSideSensor 类与 Actor 类的关系：</p>
<blockquote>
<p>ClientSideSensor 类用于模拟仿真中的传感器，能够附加到 Actor 上，例如摄像头、激光雷达等。</p>
<p>传感器可以用来获取 Actor 周围的环境数据（例如图像、点云等），以支持自动驾驶算法的训练与验证。</p>
</blockquote>
<p>World 类与其他类的关系：</p>
<blockquote>
<p>World 类表示仿真中的一个世界，它与 Client 和 Actor 类紧密关联。World 提供对仿真环境的访问，可以控制仿真世界中的所有行为体和传感器。</p>
<p>World 还负责管理交通流、物理环境、天气等仿真环境因素。</p>
</blockquote>
<h2 id="_16">总结</h2>
<p>CARLA 客户端部分提供了与仿真环境交互的丰富 API，支持开发者控制仿真世界中的各种元素，包括行为体（Actor）、传感器（ClientSideSensor）和交通流（TrafficManager）等。通过 Client 类，开发者能够加载地图、获取世界状态、管理传感器、操作物理环境等。类之间的交互使得开发者能够在仿真环境中进行精确的控制和验证。</p>
<p>参考文档：<a href="https://openhutb.github.io/carla_cpp/dir_64d7bb605f27024d49af86070bd3f0b6.html">点击此处跳转</a></p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      <script src="../../js/umlconvert.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
