<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>tuto A add vehicle - 交通仿真文档</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "tuto A add vehicle";
        var mkdocs_page_input_path = "tuto_A_add_vehicle.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> 交通仿真文档
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">主页</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">交通仿真文档</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">tuto A add vehicle</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/tuto_A_add_vehicle.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1"><a href="https://carla.readthedocs.io/en/latest/tuto_A_add_vehicle/">添加新车</a></h1>
<p>这个教程详细介绍了如何向 Carla 添加新的车辆。教程分为两个部分，一个用于四轮车辆，另一个用于两轮车辆。教程概述了建模车辆时必须满足的基本要求，以确保车辆在 Carla 中运行良好，并提供了在将车辆导入虚幻引擎后所需的配置说明。</p>
<ul>
<li><a href="#add-a-4-wheeled-vehicle"><strong>添加 4 轮车辆</strong></a></li>
<li><a href="#bind-and-model-the-vehicle">绑定并建模车辆</a></li>
<li><a href="#import-and-configure-the-vehicle">导入并配置车辆</a></li>
<li><a href="#add-a-2-wheeled-vehicle"><strong>添加 2 轮车辆</strong></a></li>
</ul>
<div class="admonition 重要">
<p class="admonition-title">重要</p>
<p>本教程仅适用于使用源代码构建并有权访问虚幻引擎编辑器的用户。</p>
</div>
<hr />
<h2 id="4">添加 4 轮车辆</h2>
<p>添加到 Carla 的车辆需要使用可在 <a href="(https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/VehicleSkeleton.rar)"><strong>此处</strong></a> 找到的通用基础骨架。此链接将下载一个名为 <code>VehicleSkeleton.rar</code> 的文件夹，其中包含两种不同格式的基本框架，一种为 ASCII，另一种为二进制。您使用的格式取决于您的 3D 建模软件要求。</p>
<p><strong>骨架骨骼的位置可以更改，但任何其他操作（例如旋转、添加新骨骼或更改当前层次结构）都会导致错误。</strong></p>
<hr />
<h3 id="_2">绑定并建模车辆</h3>
<p>本节详细介绍了车辆建模阶段的最低要求，以确保其可以在 Carla 中成功使用。该过程包括将骨架正确绑定到车辆的底座和车轮、创建物理资源和光线投射传感器网格，以及导出为正确的格式。</p>
<p><strong>1. 导入基础骨架。</strong></p>
<p>将基础骨架导入您首选的三维建模软件中。常见的编辑器包括 Maya 和 Blender。</p>
<p><strong>2. 绑定骨骼。</strong></p>
<p>根据下面的命名法将骨骼绑定到车辆网格的相应部分。确保轮子的骨骼在网格内居中。</p>
<ul>
<li><strong>左前轮：</strong> <code>Wheel_Front_Left</code></li>
<li><strong>右前轮：</strong> <code>Wheel_Front_Right</code></li>
<li><strong>左后轮：</strong> <code>Wheel_Rear_Left</code></li>
<li><strong>右后轮：</strong> <code>Wheel_Rear_Right</code></li>
<li><strong>网格的其余部分：</strong> <code>VehicleBase</code></li>
</ul>
<div class="admonition 警告">
<p class="admonition-title">警告</p>
<p>不要对骨骼名称或层次结构进行任何更改，也不要添加任何新骨骼。</p>
</div>
<p><strong>3.  为您的车辆建模。</strong></p>
<p>车辆应拥有大约 50,000 - 100,000 个 tris。我们使用实际汽车的尺寸和比例来建模车辆。</p>
<p>我们建议您将车辆分为以下材质：</p>
<blockquote>
<ol>
<li><strong>Bodywork</strong>: 车辆的金属部分。该材质已更改为虚幻引擎材质。可以添加徽标和细节，但为了可见，必须使用虚幻引擎编辑器中的 Alpha 通道将它们绘制为不同的颜色。</li>
<li><strong>Glass_Ext</strong>: 一层玻璃，可以从车辆外部看到内部。</li>
<li><strong>Glass_Int</strong>: 一层玻璃，允许从车辆内部到外部的可见性。</li>
<li><strong>Lights</strong>: 头灯、指示灯等。</li>
<li><strong>LightGlass_Ext</strong>: 一层玻璃，允许从外部到内部的灯光可见性。</li>
<li><strong>LightGlass_Int</strong>: 一层玻璃，允许从内部到外部看到光。</li>
<li><strong>LicensePlate</strong>: 29x12 厘米的矩形平面。您可以使用 Carla 提供的 <code>.fbx</code> 以获得最佳结果，请在 <a href="https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/LicensePlate.rar">此处</a> 下载。纹理将在虚幻引擎中自动分配。</li>
<li><strong>Interior</strong>: 任何其他不适合上述部分的细节都可以进入 <em>内饰</em>.</li>
</ol>
</blockquote>
<p>材料（Material）应使用格式 <code>M_CarPart_CarName</code> 命名，例如 <code>M_Bodywork_Mustang</code>。</p>
<p>纹理（Textures）应使用格式 <code>T_CarPart_CarName</code>命名，例如 <code>T_Bodywork_Mustang</code>。纹理的大小应为 2048x2048。</p>
<p>虚幻引擎会自动创建(Level of Details, LOD)，但您也可以在 3D 编辑器中手动创建它们。Tri 计数如下：</p>
<ul>
<li><strong>LOD 0</strong>: 100,000 tris</li>
<li><strong>LOD 1</strong>: 80,000 tris</li>
<li><strong>LOD 2</strong>: 60,000 tris</li>
<li><strong>LOD 3</strong>: 30,000 tris</li>
</ul>
<p><strong>4. 创建物理资源网格。</strong></p>
<p>物理资源网格是一个附加网格，允许虚幻引擎计算车辆的物理特性。它应该尽可能简单，减少多边形数量，并且应该覆盖除车轮之外的整个车辆。请参阅下图的示例。</p>
<blockquote>
<blockquote>
<p><img alt="physical asset mesh" src="../img/physical_asset_mesh.png" /></p>
</blockquote>
</blockquote>
<p>物理资源网格应导出为单独的<code>.fbx</code>文件。最终文件应满足以下要求：</p>
<ul>
<li>有一个基础网格。这应该是物理资源网格的副本。它应该与原始车辆具有相同的名称。</li>
<li>物理资源网格体必须使用格式  <code>UCX_&lt;vehicle_name&gt;_&lt;number_of_mesh&gt;</code>命名， <strong>否则虚幻引擎将无法识别。</strong></li>
<li>网格不得超出原始模型的边界。</li>
<li>网格应与原始模型具有相同的位置。</li>
</ul>
<blockquote>
<blockquote>
<p><img alt="base mesh" src="../img/base_mesh.png" /></p>
</blockquote>
</blockquote>
<p>将最终 <code>.fbx</code> 网格导出为名为 <code>SMC_&lt;vehicle_name&gt;.fbx</code>的文件。</p>
<p><strong>5. 为光线投射传感器创建网格。</strong></p>
<p>光线投射传感器网格设置将由光线投射传感器（RADAR、LiDAR 和 Semantic LiDAR）检测到的车辆形状。该网格应该具有比物理资产网格稍微更明确的几何形状，以提高传感器仿真的真实感，但出于性能原因，不如汽车网格那么详细。</p>
<p>创建光线投射传感器网格时请考虑以下几点：</p>
<ul>
<li>网格应覆盖车辆的各个方面，包括车轮、后视镜和格栅。</li>
<li>轮子应为不超过 16 圈的圆柱体。</li>
<li>如果需要，可以将各种网格连接在一起。</li>
<li>网格不得超出原始模型的边界。</li>
<li>网格应该与原始网格具有相同的位置。</li>
</ul>
<blockquote>
<blockquote>
<p><img alt="collision mesh" src="../img/collision_mesh.png" /></p>
</blockquote>
</blockquote>
<p>将最终网格导出名为 <code>SM_sc_&lt;vehicle_name&gt;.fbx</code> 的 <code>.fbx</code> 文件。</p>
<p><strong>5. 导出车辆网格。</strong></p>
<p>选择所有主要车辆网格和骨架底座并导出为<code>.fbx</code>。</p>
<hr />
<h3 id="_3">导入并配置车辆</h3>
<p>本节详细介绍了将车辆导入虚幻引擎以在 Carla 中使用的过程。在虚幻引擎编辑器中执行这些步骤。</p>
<p><strong>1. 创建车辆文件夹。</strong></p>
<p>在 <code>Content/Carla/Static/Vehicles/4Wheeled</code> 里创建一个名为 <code>&lt;vehicle_name&gt;</code> 的新文件夹。</p>
<p><strong>2. 导入 <code>.fbx</code>。</strong></p>
<p>在新的车辆文件夹中，通过在<strong><em>Content Browser</em></strong>中右键单击并选择 <strong><em>导入到 Game/Carla/Static/Vehicles/4Wheeled/&lt;vehicle_name&gt;</em></strong> 来导入主车辆骨架<code>.fbx</code>。</p>
<p>在弹出的对话框中：</p>
<ul>
<li>将导入内容类型 <strong><em>Import Content Type</em></strong> 设置为<code>Geometry and Skinning Weights</code>。</li>
<li>将 <strong><em>Normal Import Method</em></strong> 设置为 <code>Import Normals</code>。</li>
<li>（可选）将<strong><em>Material Import Method</em></strong>设置为<code>Do not create materials</code>。取消选中<strong><em>Import Textures</em></strong>以避免虚幻引擎创建默认材质。 </li>
</ul>
<p>骨架网格体将与两个新文件<code>&lt;vehicle_name&gt;_PhysicsAssets</code> and <code>&lt;vehicle_name&gt;_Skeleton</code>一起出现。</p>
<p>将其余<code>.fbx</code>文件与主车辆骨架<code>.fbx</code>文件分开导入。</p>
<p><strong>3. 设置物理资源网格。</strong></p>
<blockquote>
<ol>
<li>从内容浏览器<strong><em>Content Browser</em></strong> <code>&lt;vehicle_name&gt;_PhysicsAssets</code>。</li>
<li><strong><em>Skeleton Tree</em></strong>面板中右键单击 <code>Vehicle_Base</code> 的网格体，然后转到<strong><em>Copy Collision from StaticMesh</em></strong>。</li>
<li>搜索并选择您的<code>SMC_&lt;vehicle_name&gt;</code>文件。您应该会看到物理资源网格的轮廓出现在视口中。</li>
<li>从 <code>Vehicle_Base</code> 中删除默认的胶囊形状。</li>
<li>选择所有轮子：<ul>
<li>转到<strong><em>Tools</em></strong>面板并将“基元类型<strong><em>Primitive Type</em></strong>”更改为<code>Sphere</code>。 </li>
<li>转到详细信息<strong><em>Details</em></strong>面板并将物理类型<strong><em>Physics Type</em></strong>更改为<code>Kinematic</code>。</li>
<li>将线性阻尼<strong><em>Linear Damping</em></strong>设置为<code>0</code>。这将消除车轮上的任何额外摩擦。</li>
</ul>
</li>
<li>为所有网格启用<strong><em>Simulation Generates Hit Event</em></strong>。</li>
<li>单击<strong><em>Re-generate Bodies</em></strong>。</li>
<li>将车轮球体调整至车轮尺寸。</li>
<li>保存并关闭窗口。</li>
</ol>
<p><img alt="Collision mesh" src="../img/collision_mesh_vehicle.png" /></p>
</blockquote>
<p><strong>4. 创建动画蓝图。</strong></p>
<blockquote>
<ol>
<li>在内容浏览器<strong><em>Content Browser</em></strong>中，右键单击车辆文件夹并选择<strong><em>Animation -&gt; Animation Blueprint</em></strong>。</li>
<li>在父类<strong><em>Parent Class</em></strong>中搜索并选择<code>VehicleAnimInstance</code>。</li>
<li>在目标骨架<strong><em>Target Skeleton</em></strong>中搜索并选择<code>&lt;vehicle_name&gt;_Skeleton</code>。 </li>
<li>按<strong><em>OK</em></strong>并将蓝图重命名为<code>AnimBP_&lt;vehicle_name&gt;</code>。 </li>
</ol>
</blockquote>
<p><strong>5.  配置动画蓝图。</strong></p>
<p>为了简化配置动画蓝图的过程，我们将从本地 Carla 车辆复制现有的动画蓝图：</p>
<blockquote>
<ol>
<li>转到<code>Content/Carla/Static/Vehicle</code>并选择任何 Carla 车辆文件夹。打开其动画蓝图。</li>
<li>在<strong><em>My Blueprint</em></strong>面板中，双击<strong><em>AnimGraph</em></strong>。您将看到图表出现在视口中。 </li>
<li>单击并拖动以选择<strong><em>Mesh Space Ref Pose</em></strong>、<strong><em>Wheel Handler</em></strong>和<strong><em>Component To Local</em></strong>组件。右键单击并选择复制。</li>
<li>返回您自己的车辆动画蓝图并将复制的内容粘贴到图形区域中。</li>
<li>单击<strong><em>Component To Local</em></strong>组件中的站立人物并将其拖动到<strong><em>Output Pose</em></strong>中的人物，以将组件连接在一起。</li>
<li>单击左上角的<strong><em>Compile</em></strong>。您现在应该看到一条脉动的线流过整个序列。</li>
<li>保存并关闭窗口。</li>
</ol>
<blockquote>
<p><img alt="add_vehicle_step_04" src="../img/add_vehicle_step_04.jpg" /></p>
</blockquote>
</blockquote>
<p><strong>6. 准备车辆和车轮蓝图。</strong></p>
<blockquote>
<ol>
<li>在内容浏览器<strong><em>Content Browser</em></strong>中，转到<code>Content/Carla/Blueprints/Vehicles</code>并创建一个新文件夹<code>&lt;vehicle_name&gt;</code>。 </li>
<li>在该文件夹内，右键单击并转到<strong><em>Blueprint Class</em></strong>。在弹出窗口中打开<strong><em>All Classes</em></strong>部分。</li>
<li>搜索<code>BaseVehiclePawn</code>并按<strong><em>Select</em></strong>。</li>
<li>将文件重命名为<code>BP_&lt;vehicle_name&gt;</code>。</li>
<li>转到 <code>Carla/Blueprints/Vehicles</code> 中任何本地 Carla 车辆的文件夹。从内容浏览器<strong><em>Content Browser</em></strong>中，将四轮蓝图复制到您自己车辆的蓝图文件夹中。重命名文件以将旧车辆名称替换为您自己的车辆名称。</li>
</ol>
<blockquote>
<p><img alt="Copy wheel blueprints" src="../img/copy_wheel_blueprint.png" /></p>
</blockquote>
</blockquote>
<p><strong>7. 配置轮子蓝图。</strong></p>
<blockquote>
<ol>
<li>在车辆蓝图文件夹中，打开所有四个车轮蓝图。</li>
<li>在<strong><em>Class Defaults</em></strong>面板中，将 <strong><em>Collision Mesh</em></strong> 设置为 <code>Wheel_Shape</code>。<strong>省略此步骤将导致车辆车轮陷入地面</strong>。 </li>
<li>根据您的车辆规格调整车轮形状半径、宽度、质量和阻尼率的值。 </li>
<li>将轮胎配置<strong><em>Tire Config</em></strong>设置为<code>CommonTireConfig</code>。</li>
<li>在前轮上根据您的喜好设置转向角度 <strong><em>Steer Angle</em></strong>（默认为<code>70</code>）。取消选中<strong><em>Affected by Handbrake</em></strong> 。</li>
<li>在后轮上将转向角度 <strong><em>Steer Angle</em></strong> 设置为 <code>0</code>。检查 <strong><em>Affected by Handbrake</em></strong>。</li>
<li>设置悬架值时，您可以使用 <a href="../tuto_D_customize_vehicle_suspension/">此处</a> 的值作为指导。</li>
<li>编译并保存。</li>
</ol>
<blockquote>
<p><img alt="wheel shape" src="../img/wheel_shape.png" /></p>
</blockquote>
</blockquote>
<p><strong>8. 配置车辆蓝图。</strong></p>
<blockquote>
<ol>
<li>从内容浏览器 <strong><em>Content Browser</em></strong> 中，打开您的<code>BP_&lt;vehicle_name&gt;</code>。 </li>
<li>在 <strong><em>Components</em></strong> 面板中，选择 <strong><em>Mesh (VehicleMesh) (Inherited)</em></strong> 。</li>
<li>在 <strong><em>Details</em></strong> 面板中，转到 <strong><em>Skeletal Mesh</em></strong> 并搜索并选择车辆的基础骨架文件（位于 <code>Carla/Static/Vehicles/4Wheeled/&lt;vehicle_name&gt;</code> 文件夹中）。 </li>
<li>转到 <strong><em>Details</em></strong> 面板中的 <strong><em>Anim Class</em></strong>。搜索并选择您的 <code>AnimBP_&lt;vehicle_name&gt;</code> 文件。</li>
<li>在 <strong><em>Components</em></strong> 面板中，选择 <strong><em>Custom Collision (Inherited)</em></strong> 。</li>
<li>在 <strong><em>Details</em></strong> 面板中选择 <strong><em>Static Mesh</em></strong> 并搜索您的 <code>SM_sc_&lt;vehicle_name&gt;</code> 光线投射传感器网格体。</li>
<li>在 <strong><em>Components</em></strong> 面板中，选择 <strong><em>VehicleMovement (MovementComp) (Inherited)</em></strong> 。 </li>
<li>在 <strong><em>Details</em></strong> 面板中，搜索 <code>wheel</code> 。您将找到每个轮子的设置。对于每一个，单击 <strong><em>Wheel Class</em></strong> 并搜索与正确车轮位置相对应的<code>BP_&lt;vehicle_name&gt;_&lt;wheel_name&gt;</code>文件。 </li>
</ol>
<blockquote>
<blockquote>
<blockquote>
<p><img alt="wheel blueprint" src="../img/wheel_blueprint.png" /></p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>如果您的车辆有任何与基础网格分开的附加网格（门、灯等）：</p>
<blockquote>
<ol>
<li>将它们拖到<strong><em>Components</em></strong>面板中的 <strong><em>Mesh (VehicleMesh) (Inherited)</em></strong> 层次结构中。</li>
<li>选择层次结构中的额外网格并在<strong><em>Details</em></strong>面板中搜索 <code>Collision</code>。 </li>
<li>将碰撞预设 <strong><em>Collision Presets</em></strong> 设置为 <code>NoCollision</code>。</li>
<li>选择层次结构中的任何灯光网格。在 <strong><em>Details</em></strong> 面板中搜索 <code>Tag</code> 并添加标签 <code>emissive</code>。 </li>
</ol>
</blockquote>
<p>单击 <strong><em>Save</em></strong> 并 <strong><em>Compile</em></strong> 。</p>
<ul>
<li>我们还可以<a href="../custom_plate/">自定义车辆的车牌</a>。</li>
</ul>
<p><strong>9. 将车辆添加到蓝图库中。</strong>.</p>
<blockquote>
<ol>
<li>在 <code>Content/Carla/Blueprint/Vehicle</code> 中，打开 <code>VehicleFactory</code> 文件。</li>
<li>在 <strong><em>Generate Definitions</em></strong> 选项卡中，双击 <strong><em>Vehicles</em></strong> 。</li>
<li>在 <strong><em>Details</em></strong> 面板中，展开 <strong><em>Default Value</em></strong> 部分并向车辆数组添加一个新元素。 </li>
<li>填写您车辆的 <strong><em>Make</em></strong> 和 <strong><em>Model</em></strong> 。 </li>
<li>使用您的 <code>BP_&lt;vehicle_name&gt;</code> 文件填写 <strong><em>Class</em></strong> 值。</li>
<li>（可选）为车辆提供一组推荐颜色。</li>
<li>编译并保存。</li>
</ol>
<p><img alt="vehicle factory" src="../img/vehicle_factory.png" /></p>
</blockquote>
<p><strong>10. 测试车辆</strong>。</p>
<p>启动 Carla，打开终端 <code>PythonAPI/examples</code> 并运行以下命令：</p>
<pre><code class="language-sh">python3 manual_control.py --filter &lt;model_name&gt; # The make or model defined in step 9
</code></pre>
<div class="admonition 笔记">
<p class="admonition-title">笔记</p>
<p>即使您在品牌和型号中使用了大写字符，它们在传递给过滤器时也需要转换为小写字符。</p>
</div>
<hr />
<h2 id="n">添加 N 轮车辆</h2>
<p>添加 N 轮车辆遵循与上述 4 轮车辆相同的导入管道，但有几个步骤不同。</p>
<p><strong>5.</strong> <strong>配置 N 轮车辆的动画蓝图</strong></p>
<p>搜索 <code>BaseVehiclePawnNW</code> 并按 <strong><em>Select</em></strong>。</p>
<p><img alt="n_wheel_base" src="../img/base_nw.png" /></p>
<p><strong>6.</strong> <strong>准备车辆和车轮蓝图</strong></p>
<p>转到 Carla/Blueprints/Vehicles 中所有本地 Carla 车辆的文件夹。从内容浏览器中，将四轮蓝图复制到您自己车辆的蓝图文件夹中。重命名文件以将旧车辆名称替换为您自己的车辆名称。</p>
<p>复制四个轮子，然后再次复制其他轮子。如果是 6 轮车辆，您将需要 6 个不同的车轮：FLW、FRW、MLW、MRW、RLW、RRW。</p>
<p><img alt="n_wheel_bps" src="../img/nwheels.png" /></p>
<p><strong>7.</strong> <strong>配置轮子蓝图</strong></p>
<p>对于 4 轮车辆，请遵循上述第 <strong>7</strong> 节。 N 轮车辆的主要区别在于手刹和转向参数的影响。在某些车辆（例如长轴距卡车）中，前 2 对车轮将进行转向，其中一组可能比其他车轮转向更多。最后面的一对可能会受到手刹的影响，具体情况取决于您正在建模的车辆。</p>
<p><strong>8.</strong> <strong>配置车辆蓝图</strong></p>
<p>在“详细信息”面板中，搜索<code>wheel</code>。您将找到每个轮子的设置。对于每一个，单击车轮类别并搜索 BP_<vehicle_name>_<wheel_name> 对应于正确车轮位置的文件。</p>
<p>这是正确的，但只是为了指定，在 N 轮车辆的情况下，您需要设置所有车轮。这是 6 轮车辆的示例：</p>
<p><img alt="n_wheel_config" src="../img/nwheel_config.png" /></p>
<p>最后，一个额外的考虑因素是设置差速器。对于 4 轮车辆，我们有不同的差速器预设（限滑、开放 4W 等），但对于 N 轮车辆，您需要选择要在哪些车轮上应用扭矩。本例中我们选择只有中后轮有扭矩，前轮没有扭矩，您可以指定其他配置。这些数字将与本文上方的图像相同（例如，0 将是左前轮，如上所述）。</p>
<p><img alt="n_wheel_mech" src="../img/nwheel_mech_setup.png" /></p>
<p>所有其他参数，如发动机、变速箱、转向曲线，均与四轮车辆相同。</p>
<hr />
<h2 id="2">添加 2 轮车辆</h2>
<p>添加 2 轮车辆与添加 4 轮车辆类似，但由于动画的复杂性，您需要设置额外的骨骼来引导驾驶员的动画。<a href="https://carla-assets.s3.eu-west-3.amazonaws.com/fbx/BikeSkeleton.rar">这</a> 是两轮车辆参考骨架的链接。</p>
<p>与 4 轮车辆一样，将模型朝向正“x”，每个骨骼轴朝向正 x，z 轴朝上。</p>
<pre><code class="language-yaml">Bone Setup:
  - Bike_Rig:                   # 网格的原点。将其放置在场景的0点
    - BikeBody:                 # 模型身体的中心。
      - Pedals:                 # 如果车辆是自行车，将脚踏板绑在这块骨头上，就会随着自行车的加速度而旋转。
        - RightPedal:           # 如果车辆是自行车，则设置驾驶员的脚部位置并与脚踏板一起旋转。
        - LeftPedal:            # ^
      - RearWheel:              # 车辆后轮
      - Handler:                # 与车辆的前轮一起旋转，将车辆操纵器固定在其上。
        - HandlerMidBone:       # 定位在前轮骨架上，以确定操纵器与车轮的方向
        - HandlerRight:         # 设置驾驶员的手的位置，无需将其绑定到任何东西。
        - HandlerLeft:          # ^
      - Frontwheel:             # 车辆的前轮。
      - RightHelperRotator:     # 这四块额外的骨头是为一个过时的系统提供的，该系统通过使用传统的隐形车轮使自行车稳定 
        - RightHelprWheel:      # ^
      - LeftHelperRotator:      # ^
        - LeftHelperWheel:      # ^
      - Seat:                   # 设置驾驶员髋骨的位置。无需将其绑在任何东西上，只需小心放置即可。
</code></pre>
<p><strong>1.</strong> 将 fbx 作为 Skelletal Mesh 导入到其自己的 <code>Content/Carla/Static/Vehicles/2Wheeled</code> 文件夹中。导入时，选择“General2WheeledVehicleSkeleton”作为骨架，应自动创建并链接物理资源。</p>
<p><strong>2.</strong> 调整物理资源。删除自动创建的框并向 <code>BikeBody</code> 骨骼添加框，尝试尽可能匹配形状，确保启用生成命中事件。为每个轮子添加一个球体并将其“物理类型”设置为“运动学”。</p>
<p><strong>3.</strong> 创建 <code>Content/Blueprints/Vehicles/&lt;vehicle-model&gt;</code> 文件夹  </p>
<p><strong>4.</strong> 在该文件夹内创建两个派生自“VehicleWheel”类的蓝图类。调用 <code>&lt;vehicle-model&gt;_FrontWheel</code> 和 <code>&lt;vehicle-model&gt;_RearWheel</code>。将其 "Shape Radius" 设置为与网格轮半径完全匹配（小心，半径不是直径）。将其“轮胎配置”设置为“CommonTireConfig”。在前轮上取消选中“受手刹影响”，在后轮上将“转向角”设置为零。</p>
<p><strong>5.</strong> 在同一文件夹内创建一个派生 <code>Base2WheeledVehicle</code> 的蓝图类，并调用它 <code>&lt;vehicle-model&gt;</code> 。打开它进行编辑，选择组件“Mesh”，将“Skeletal Mesh”和“Anim Class”设置为相应的。然后选择 VehicleBounds 组件并设置大小以覆盖车辆区域（如上图所示）。</p>
<p><strong>6.</strong> 选择组件“VehicleMovement”，在“Vehicle Setup”下展开“Wheel Setups”，设置各个车轮。</p>
<ul>
<li><strong>0:</strong> 轮类=<code>&lt;vehicle-model&gt;_FrontWheel</code>, 骨骼名称=<code>FrontWheel</code>  </li>
<li><strong>1:</strong> 轮类=<code>&lt;vehicle-model&gt;_FrontWheel</code>, 骨骼名称=<code>FrontWheel</code>  </li>
<li><strong>2:</strong> 轮类=<code>&lt;vehicle-model&gt;_RearWheel</code>, 骨骼名称=<code>RearWheel</code>  </li>
<li><strong>3:</strong> 轮类=<code>&lt;vehicle-model&gt;_RearWheel</code>, 骨骼名称=<code>RearWheel</code><br />
  （您会注意到，我们基本上在每个骨骼中放置了两个轮子。unreal 提供的车辆类别不支持车轮编号不同于 4 的车辆，因此我们必须让它相信车辆具有4个轮子）</li>
</ul>
<p><strong>7.</strong> 选择变量 "is bike" ，如果您的型号是自行车，则勾选它。这将激活踏板旋转。如果您要安装摩托车，请不要标记。 </p>
<p><strong>8.</strong> 找到变量 back Rotation 并将其设置为更合适的位置，更好地选择组件 SkeletalMesh（驱动程序）并将其沿 x 轴移动，直到其位于座椅位置。 </p>
<p><strong>9.</strong> 测试一下，进入CarlaGameMode蓝图并将“Default Pawn Class”更改为新创建的自行车蓝图。</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../extra.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
