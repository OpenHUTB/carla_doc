<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Pixel streaming - 人车模拟器</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../../extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Pixel streaming";
        var mkdocs_page_input_path = "ue/pixel_streaming.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> 人车模拟器
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">首页</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">人车模拟器</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Pixel streaming</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/OpenHUTB/carla_doc/edit/master/docs/ue/pixel_streaming.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h2 id="_1">像素流推送</h2>
<h3 id="_2">步骤</h3>
<p>参考<a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/getting-started-with-pixel-streaming?application_version=4.27">链接</a> 进行配置：</p>
<ol>
<li>打开像素流插件；</li>
<li>在主菜单中选择 编辑（Edit） &gt; 编辑器偏好（Editor Preferences...）。然后在 关卡编辑器（Level Editor） &gt; 播放（Play） 中找到 额外启动参数（Additional Launch Parameters） 设置，并将其值设为 <code>-AudioMixer -PixelStreamingIP=localhost -PixelStreamingPort=8888</code>。</li>
<li>按住 Alt 键并拖动 .exe 文件即可在相同文件夹中（或在其他任意处）新建一个快捷方式。右键点击快捷方式并从上下文菜单中选择 属性（Properties）。在 <em>快捷方式属性（Shortcut Properties） 窗口的 快捷方式（Shortcut） 选项卡中，在 目标（Target） 域的末尾附加文本 <code>-AudioMixer -PixelStreamingIP=localhost -PixelStreamingPort=8888 -RenderOffScreen</code> 并点击 确认</em>*。</li>
<li>启动<code>CarlaUE4.exe</code>，从<a href="https://nodejs.org/zh-cn/download">链接</a> 下载并安装node.js，然后启动像素流的信令服务<code>run.bat</code>；</li>
<li>使用浏览器访问 <a href="http://127.0.0.1/">http://127.0.0.1/</a> 测试是否能够访问到像素流。</li>
</ol>
<h3 id="_3">优化</h3>
<p>量化参数（Quantization Parameter, QP）值用于控制每帧视频中每一个宏块的压缩量，和比特率成反比，QP值越小画质越高。</p>
<h3 id="_4">问题</h3>
<blockquote>
<p>使用链接<code>http://127.0.0.1:8888</code>访问时出现：<code>Upgrade Required</code>，改用地址<code>http://127.0.0.1:80</code>访问则没有问题。</p>
<p>当启动信令服务后访问不了像素流（出现：Disconnected: Streamer is not connected），尝试关闭系统代理然后再访问。</p>
</blockquote>
<p>排查<code>netstat -ano|findstr “8888”</code>端口是否被占用</p>
<p>出现<code>Streamer connected: ::1</code>才表示像素流正常工作。</p>
<blockquote>
<ul>
<li>页面中点击开始后，出现<code>Fatal error!</code>的错误。命令行同时出现<code>streamer disconnected: 4000 - Failed to parse answer's SDP</code>的错误。</li>
</ul>
<p>解决：参考 <a href="https://zhuanlan.zhihu.com/p/383825174">链接</a> ，或者复制 <a href="https://github.com/OpenHUTB/gpt">gpt</a> 中的文件替换，即：</p>
<p>在<code>Engine/Source/Programs/PixelStreaming/WebServers/SignallingWebServer/scripts/webRtcPlayer.js</code>于61行添加：
<div class="highlight"><pre><span></span><code>this.cfg.offerExtmapAllowMixed = false;
</code></pre></div>
第125行添加下行代码：
<div class="highlight"><pre><span></span><code>offer.sdp<span class="w"> </span><span class="o">=</span><span class="w"> </span>offer.sdp.replace<span class="o">(</span>/<span class="o">(</span><span class="nv">a</span><span class="o">=</span>extmap-allow-mixed<span class="o">)</span><span class="se">\r\n</span>/gm,<span class="w"> </span><span class="s2">&quot;&quot;</span><span class="o">)</span><span class="p">;</span>
</code></pre></div></p>
</blockquote>
<h3 id="_5">参考</h3>
<ul>
<li><a href="https://github.com/OpenHUTB/gpt/tree/main/sim/WindowsNoEditor/Engine/Source/Programs/PixelStreaming/WebServers/SignallingWebServer">交通大模型实现的像素流推送</a></li>
<li><a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/getting-started-with-pixel-streaming?application_version=4.27">像素流送入门</a></li>
<li><a href="https://dev.epicgames.com/documentation/zh-cn/unreal-engine/stream-tuning-guide">流送优化指南</a></li>
</ul>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/OpenHUTB/carla_doc" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script src="https://cdn.rawgit.com/knsv/mermaid/6.0.0/dist/mermaid.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sequence-diagrams/1.0.6/sequence-diagram-min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"></script>
      <script src="../../js/umlconvert.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
